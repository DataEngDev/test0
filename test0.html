<!DOCTYPE html>
<html>
<!-- TO DO:

    * Content
    - Something to replace the hidden Approaches section
    - Most common question: how do I convince my team to test?

    * Layout
    - URL footer on first few slides.



    # Getting Started Testing

    - Goal
        - Give you tools to start testing your code

    - Two challenges:
        - People
        - Code

    - Vegetables

    = People

    - Why test?
        - Best way to know if your code works
    - Resistance
        - More work
        - Hard to add to a legacy project
        - Not a developer's job?
    - Benefits
        - Confidence
        - Turns fear into boredom
        - Faster in the long run
    - Fighting Chaos!
    - How to start
        - Start with the easy
        - Start with the necessary

    = Code

    - 2 vs 3

    - How to write tests
        - Show *a* way to do it.
        - there are many techniques

    = First principles

    - Product code: stock portfolio
    
    - First test: interactive
    
    - Second test: standalone

    - Third test: with expected results

    - Fourth test: check results automatically

    - Getting complicated!

    = Unittest

    - unittest
        - stdlib
        - a good solid foundation
        - not the only way to do it
        - not about unit vs integration

    - Simple unit test

    = Test Doubles


    = Other stuff
    - doctest
    - coverage
    - nose, py.test, trial
    - lettuce
    - Selenium
    - ddt
    - TDD

-->
<!-- *** Head stuff {{{ -->
<!--[[[cog
import cog
from cogutil import *
]]]-->
<!--[[[end]]]-->
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <!-- Slide meta data, remove/edit as you see fit -->
    <title>Getting Started Testing</title>

    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,600,700,800|Permanent+Marker' rel='stylesheet' type='text/css'>

    <!-- Slippy core file and dependencies -->
    <script type="text/javascript" src="slippy/src/jquery.min.js"></script>
    <script type="text/javascript" src="slippy/src/jquery.history.js"></script>
    <!-- Slippy slides -->
    <script type="text/javascript" src="slippy/src/slippy.js"></script>
    <link type="text/css" rel="stylesheet" href="slippy/src/slippy.css"/>
    <link type="text/css" rel="stylesheet" href="slippy/src/slippy-pure.css"/>

    <!-- Ned's slides init code -->
    <script type="text/javascript" src="lineselect.js"></script>

    <!-- Init code -->
    <script type="text/javascript">
        $(function() {
            if ($("body.slides").length) {
                $(".slide").slippy({
                    // settings go here
                    // possible values are:
                    //  - animLen, duration for default animations (0 = disabled)
                    //  - animInForward, receives a slide and animates it
                    //  - animInRewind, receives a slide and animates it
                    //  - animOutForward, receives a slide and animates it
                    //  - animOutRewind, receives a slide and animates it
                    //  - baseWidth, defines the base for img resizing, if you don't want only
                    //    full-width images, specify this as the pixel width of a slide so that
                    //    images are scaled properly (default is 620px wide)
                    //  - ratio, defines the width/height ratio of the slides, defaults to 1.3 (620x476)
                    //  - margin, the fraction of screen to use as slide margin, defaults to 0.15
                    margin: 0.04,
                    incrementalBefore: function (el) {
                        $(el).css({ opacity: 0.01 });
                    },
                    animInForward: function (slide) {
                        var slide = $(slide);
                        if (slide.hasClass("fadein")) {
                            slide.css('opacity', '0').css('left', '50%').animate({opacity: '1'}, 350);
                        }
                        else {
                            slide.css('left', '150%').animate({left: '50%'}, 350);
                        }
                    },
                    animOutForward: function(slide) {
                        var slide = $(slide);
                        if (slide.hasClass("fadeout")) {
                            slide.animate({opacity: '1'}, 350).animate({left: '-50%'}, 0);
                        }
                        else {
                            slide.animate({left: '-50%'}, 350);
                        }
                    }
                });
            }

            $("div.slide").lineselect({ lines: ".code .line" });
        });
    </script>

    <!-- Custom style for this deck -->
    <style type="text/css">
        body, html {
            background: #333;
            font-family: "Open Sans", sans-serif;
        }

        div.text {
            display: none;
        }

        div.code.text {
            display: block;
        }

        .slide {
            font-family: "Open Sans", sans-serif;
            font-weight: 600;
            margin: 1em;
            border: 1px solid #ccc;
            border-radius: 1em;
            background: #fffaf0;
            font-size: 150%;
        }
        h1, h2, h3, h4 {
            font-family: "Open Sans", sans-serif;
            font-weight: 700;
            line-height: 1.5;
            text-align: left;
            word-spacing: .1em;
        }

        .slide.title h1 {
            font-family: "Open Sans", sans-serif;
            font-weight: 800;
            margin-top: 3em;
            font-size: 200%;
            text-align: center;
        }
        .slide.title h2 {
            text-align: center;
            font-size: 125%;
            color: #666;
            margin-top: 2em;
        }
        .slide.section {
            background-color: #ff8;
        }
        .slide.todo {
            background-color: #f88;
        }
        .slide.section h1 {
            font-family: "Open Sans", sans-serif;
            font-weight: 700;
            margin-top: 3em;
            font-size: 200%;
            text-align: center;
        }
        .slide.section h2 {
            text-align: center;
            font-size: 125%;
            color: #666;
            margin-top: 2em;
        }
        .hidden_slide {
            display: none;
        }
        .slide p {
            text-align: left;
            margin-top: 1em;
        }
        .slide.nofooter {
            border: 0;
            background: 0;
        }
        .slide .footer {
            font-weight: 400;
            color: #666;
        }
        .slide .footer .punct {
            padding: 0 .1em;
            color: #999;
        }

        .slide p.generic {
            font-family: serif;
            margin-top: .5em;
        }

        .slide .code {
            font-family: Consolas, monaco, monospace;
            font-weight: 600
            margin-top: 1em;
            background: #ccf;
            padding: .25em .25em;
            line-height: 1.15;
            font-size: 75%;
        }

        .slide .code.python {
            background: #beb;
        }

        .code .selected {
            background: #fff;
            /*
            border: 1px solid black;
            border-width: 0 0 0 .25em;
            margin-left: -.5em;
            padding-left: .25em;
            */
        }

        .code .selected .lineno {
            background: #060;
            color: white;
            padding-left: .25em;
            margin-left: -.25em;
        }

        .slide li {
            list-style: none;
            margin-top: .5em;
        }

        body.notes {
            overflow: auto;
            background: white;
        }
        .notes .slide {
            position: static;
            left: auto;
            top: auto;
            width: 20em;
            height: auto;
            border: 2px solid #888;
            padding: 1em 2em;
            margin: 1em 1em;
            font-size: 100%;
        }
        .notes img {
            display: none;
        }

        .code .lineno {
            width: 1em;
            display: inline-block;
            text-align: right;
            padding-right: .5em;
            color: #999;
            font-style: italic;
            font-weight: 400;
            border-right: 1px dotted #999;
        }

        .code .hll { background-color: #ffffcc }
        .code  { background: #f8f8f8; }
        .code .c { color: #306030; font-style: italic } /* Comment */
        .code .err { border: 1px solid #FF0000 } /* Error */
        .code .k { color: #006000; font-weight: bold } /* Keyword */
        .code .o { color: #666666 } /* Operator */
        .code .cm { color: #408080; font-style: italic } /* Comment.Multiline */
        .code .cp { color: #BC7A00 } /* Comment.Preproc */
        .code .c1 { color: #408080; font-style: italic } /* Comment.Single */
        .code .cs { color: #408080; font-style: italic } /* Comment.Special */
        .code .gd { color: #A00000 } /* Generic.Deleted */
        .code .ge { font-style: italic } /* Generic.Emph */
        .code .gr { color: #FF0000 } /* Generic.Error */
        .code .gh { color: #000080; font-weight: bold } /* Generic.Heading */
        .code .gi { color: #00A000 } /* Generic.Inserted */
        .code .go { color: #993333 } /* Generic.Output */
        .code .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
        .code .gs { font-weight: bold } /* Generic.Strong */
        .code .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
        .code .gt { color: #0044DD } /* Generic.Traceback */
        .code .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
        .code .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
        .code .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
        .code .kp { color: #008000 } /* Keyword.Pseudo */
        .code .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
        .code .kt { color: #B00040 } /* Keyword.Type */
        .code .m { color: #333333 } /* Literal.Number */
        .code .s { color: #BA2121 } /* Literal.String */
        .code .na { color: #7D9029 } /* Name.Attribute */
        .code .nb { color: #008000 } /* Name.Builtin */
        .code .nc { color: #0000FF; font-weight: bold } /* Name.Class */
        .code .no { color: #880000 } /* Name.Constant */
        .code .nd { color: #AA22FF } /* Name.Decorator */
        .code .ni { color: #999999; font-weight: bold } /* Name.Entity */
        .code .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
        .code .nf { color: #0000FF } /* Name.Function */
        .code .nl { color: #A0A000 } /* Name.Label */
        .code .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
        .code .nt { color: #008000; font-weight: bold } /* Name.Tag */
        .code .nv { color: #19177C } /* Name.Variable */
        .code .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
        .code .w { color: #bbbbbb } /* Text.Whitespace */
        .code .mf { color: #333333 } /* Literal.Number.Float */
        .code .mh { color: #333333 } /* Literal.Number.Hex */
        .code .mi { color: #333333 } /* Literal.Number.Integer */
        .code .mo { color: #333333 } /* Literal.Number.Oct */
        .code .sb { color: #BA2121 } /* Literal.String.Backtick */
        .code .sc { color: #BA2121 } /* Literal.String.Char */
        .code .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
        .code .s2 { color: #BA2121 } /* Literal.String.Double */
        .code .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
        .code .sh { color: #BA2121 } /* Literal.String.Heredoc */
        .code .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
        .code .sx { color: #008000 } /* Literal.String.Other */
        .code .sr { color: #BB6688 } /* Literal.String.Regex */
        .code .s1 { color: #BA2121 } /* Literal.String.Single */
        .code .ss { color: #19177C } /* Literal.String.Symbol */
        .code .bp { color: #008000 } /* Name.Builtin.Pseudo */
        .code .vc { color: #19177C } /* Name.Variable.Class */
        .code .vg { color: #19177C } /* Name.Variable.Global */
        .code .vi { color: #19177C } /* Name.Variable.Instance */
        .code .il { color: #666666 } /* Literal.Number.Integer.Long */

    </style>

</head>
<!-- }}} -->

<body class="slides">

<!-- *** Slide layouts {{{ -->

<div class="layout" data-name="default">
    <content></content>
    <!--
    <div class="footer">
        <span class="left">@nedbat</span>
        <span class="right">http://nedbatchelder.com/text/aware.html</span>
        <hr class="defloat" />
    </div>
    -->
</div>

<div class="layout" data-name="withurl">
    <content></content>
    <div class="footer">
        <span class="left">@nedbat</span>
        <span class="right">http://nedbatchelder.com/text/starttest.html</span>
        <hr class="defloat" />
    </div>
</div>

<div class="layout nochrome" data-name="clean">
    <content></content>
</div>

<!--
<div class="slide">
    <h1>Style test, including a very long title that wraps I think</h1>
    <ul>
        <li>A simple bullet</li>
        <li>A long bullet that has a very important point to make, or it better, else why would it be so long?</li>
        <li>This has sub-bullets:
        <ul>
            <li>First</li>
            <li>Second</li>
        </ul>
        </li>
    </ul>
</div>
-->

<!-- }}} -->

<!-- *** Introduction {{{ -->

<div class="slide title" data-layout="clean">
    <h1>Getting Started Testing</h1>
    <h2>Ned Batchelder</h2>
    <h2>@nedbat</h2>
    <h2 style="margin-top:1em">http://nedbatchelder/text/starttest.html</h2>
    <div class="footer"><span class="left">&copy; 2014, Ned Batchelder</span><hr class="defloat" /></div>
</div>

<div class="hidden_slide">
    <h1>Font test</h1>
    <ul>
        <li>This is a long sentence with many words, what do I think of it?</li>
        <li>This isn't "straight" quotes.</li>
        <li>This isn&rsquo;t &ldquo;straight&rdquo; quotes.</li>
        <li></li>
    </ul>
</div>

<div class="slide" data-layout="withurl">
    <h1>Goals</h1>
    <ul>
        <li>Convince you to test</li>
        <li>Show you a way to test your Python code</li>
        <li>Remove the mystery</li>
    </ul>
</div>

<div class="slide">
    <h1>Two challenges</h1>
    <ul>
        <li>People</li>
        <li>Code</li>
    </ul>
</div>

<div class="slide section">
    <h1>People</h1>
</div>

<div class="slide">
    <h1></h1>
    <ul>
        <li>Testing is a lot of work</li>
        <li>People won't want to do it</li>
        <li>It pays off in the long run</li>
        <li>Turns fear into boredom</li>
    </ul>
</div>

<div class="slide" data-layout="withurl">
    <h1>Why test?</h1>
    <ul>
        <li>The best way to know if your code works</li>
        <li>Saves time in the long run</li>
        <li>Produces better code</li>
        <li>Removes fear from development</li>
    </ul>
</div>

<div class="slide" data-layout="withurl">
    <h1>Testing mindset</h1>
    <p class="incremental" style='font-family: "Permanent Marker"; font-size: 450%; text-align: center; color: red'>I&nbsp;  AM&nbsp;  BAD!</p>
    <p class="incremental" style='font-family: "Permanent Marker"; font-size: 200%; text-align: center; color: red; letter-spacing: .05em'>and I should feel bad</p>
</div>

<div class="slide" data-layout="withurl">
    <h1>Reality</h1>
    <ul>
        <li class="incremental">You aren't bad</li>
        <li class="incremental">Testing is hard</li>
        <li class="incremental">It's worth it</li>
    </ul>
</div>

<!-- }}} -->

<!-- *** Blank slides {{{ 

<div class="slide">
    <h1></h1>
    <ul>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
    </ul>
</div>

 }}} -->

<!-- *** Grow a first test {{{ -->
<div class="slide section" data-layout="clean">
    <h1>Starting from first principles</h1>
    <h2>Evolving tests</h2>
</div>

<div class="slide">
    <h1>Stock portfolio class</h1>
    <p>A simple system under test:</p>
    <!--[[[cog
    include_file("portfolio1.py")   # {{{
    ]]]-->
    <!--
    # portfolio1.py

    class Portfolio(object):
        """A simple stock portfolio"""
        def __init__(self):
            # stocks is a list of lists:
            #   [[name, shares, price], ...]
            self.stocks = []

        def buy(self, name, shares, price):
            """Buy `name`: `shares` shares at `price`."""
            self.stocks.append([name, shares, price])

        def cost(self):
            """What was the total cost of this portfolio?"""
            amt = 0.0
            for name, shares, price in self.stocks:
                amt += shares * price
            return amt
    -->
    <div class="code python"><div class="line"><span class="lineno"> 1</span> <span class="c">#&#xA0;portfolio1.py</span>&nbsp;</div>
    <div class="line"><span class="lineno"> 2</span>&nbsp;</div>
    <div class="line"><span class="lineno"> 3</span> <span class="k">class</span>&#xA0;<span class="nc">Portfolio</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>&nbsp;</div>
    <div class="line"><span class="lineno"> 4</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="sd">&quot;&quot;&quot;A&#xA0;simple&#xA0;stock&#xA0;portfolio&quot;&quot;&quot;</span>&nbsp;</div>
    <div class="line"><span class="lineno"> 5</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="k">def</span>&#xA0;<span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>&nbsp;</div>
    <div class="line"><span class="lineno"> 6</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="c">#&#xA0;stocks&#xA0;is&#xA0;a&#xA0;list&#xA0;of&#xA0;lists:</span>&nbsp;</div>
    <div class="line"><span class="lineno"> 7</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="c">#&#xA0;&#xA0;&#xA0;[[name,&#xA0;shares,&#xA0;price],&#xA0;...]</span>&nbsp;</div>
    <div class="line"><span class="lineno"> 8</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="bp">self</span><span class="o">.</span><span class="n">stocks</span>&#xA0;<span class="o">=</span>&#xA0;<span class="p">[]</span>&nbsp;</div>
    <div class="line"><span class="lineno"> 9</span>&nbsp;</div>
    <div class="line"><span class="lineno">10</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="k">def</span>&#xA0;<span class="nf">buy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>&#xA0;<span class="n">name</span><span class="p">,</span>&#xA0;<span class="n">shares</span><span class="p">,</span>&#xA0;<span class="n">price</span><span class="p">):</span>&nbsp;</div>
    <div class="line"><span class="lineno">11</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="sd">&quot;&quot;&quot;Buy&#xA0;`name`:&#xA0;`shares`&#xA0;shares&#xA0;at&#xA0;`price`.&quot;&quot;&quot;</span>&nbsp;</div>
    <div class="line"><span class="lineno">12</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="bp">self</span><span class="o">.</span><span class="n">stocks</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">name</span><span class="p">,</span>&#xA0;<span class="n">shares</span><span class="p">,</span>&#xA0;<span class="n">price</span><span class="p">])</span>&nbsp;</div>
    <div class="line"><span class="lineno">13</span>&nbsp;</div>
    <div class="line"><span class="lineno">14</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="k">def</span>&#xA0;<span class="nf">cost</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>&nbsp;</div>
    <div class="line"><span class="lineno">15</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="sd">&quot;&quot;&quot;What&#xA0;was&#xA0;the&#xA0;total&#xA0;cost&#xA0;of&#xA0;this&#xA0;portfolio?&quot;&quot;&quot;</span>&nbsp;</div>
    <div class="line"><span class="lineno">16</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">amt</span>&#xA0;<span class="o">=</span>&#xA0;<span class="mf">0.0</span>&nbsp;</div>
    <div class="line"><span class="lineno">17</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="k">for</span>&#xA0;<span class="n">name</span><span class="p">,</span>&#xA0;<span class="n">shares</span><span class="p">,</span>&#xA0;<span class="n">price</span>&#xA0;<span class="ow">in</span>&#xA0;<span class="bp">self</span><span class="o">.</span><span class="n">stocks</span><span class="p">:</span>&nbsp;</div>
    <div class="line"><span class="lineno">18</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">amt</span>&#xA0;<span class="o">+=</span>&#xA0;<span class="n">shares</span>&#xA0;<span class="o">*</span>&#xA0;<span class="n">price</span>&nbsp;</div>
    <div class="line"><span class="lineno">19</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="k">return</span>&#xA0;<span class="n">amt</span>&nbsp;</div>
    </div>
        <!--[[[end]]] }}}-->
</div>

<div class="slide">
    <h1>First test: interactive</h1>
    <!-- ** Interactive session {{{ -->
    <!--[[[cog
    prompt_session("""\
        from portfolio1 import Portfolio
        p = Portfolio()
        p.cost()

        p.buy("IBM", 100, 176.48)
        p.cost()

        p.buy("HPQ", 100, 36.15)
        p.cost()
        """)
    ]]]-->
    <div class="code pycon"><div class="line"><span class="go">$&#xA0;python</span>&nbsp;</div>
    <div class="line"><span class="go">Python&#xA0;2.7.5&#xA0;(default,&#xA0;Aug&#xA0;&#xA0;5&#xA0;2013,&#xA0;19:47:08)&#xA0;</span>&nbsp;</div>
    <div class="line">&nbsp;</div>
    <div class="line"><span class="gp">&gt;&gt;&gt;&#xA0;</span><span class="kn">from</span>&#xA0;<span class="nn">portfolio1</span>&#xA0;<span class="kn">import</span>&#xA0;<span class="n">Portfolio</span>&nbsp;</div>
    <div class="line"><span class="gp">&gt;&gt;&gt;&#xA0;</span><span class="n">p</span>&#xA0;<span class="o">=</span>&#xA0;<span class="n">Portfolio</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="gp">&gt;&gt;&gt;&#xA0;</span><span class="n">p</span><span class="o">.</span><span class="n">cost</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="go">0.0</span>&nbsp;</div>
    <div class="line">&nbsp;</div>
    <div class="line"><span class="gp">&gt;&gt;&gt;&#xA0;</span><span class="n">p</span><span class="o">.</span><span class="n">buy</span><span class="p">(</span><span class="s">&quot;IBM&quot;</span><span class="p">,</span>&#xA0;<span class="mi">100</span><span class="p">,</span>&#xA0;<span class="mf">176.48</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="gp">&gt;&gt;&gt;&#xA0;</span><span class="n">p</span><span class="o">.</span><span class="n">cost</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="go">17648.0</span>&nbsp;</div>
    <div class="line">&nbsp;</div>
    <div class="line"><span class="gp">&gt;&gt;&gt;&#xA0;</span><span class="n">p</span><span class="o">.</span><span class="n">buy</span><span class="p">(</span><span class="s">&quot;HPQ&quot;</span><span class="p">,</span>&#xA0;<span class="mi">100</span><span class="p">,</span>&#xA0;<span class="mf">36.15</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="gp">&gt;&gt;&gt;&#xA0;</span><span class="n">p</span><span class="o">.</span><span class="n">cost</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="go">21263.0</span>&nbsp;</div>
    </div>
    <!--[[[end]]] }}}-->
    <ul>
    <li>Good: testing the code</li>
    <li>Bad: not repeatable</li>
    <li>Bad: labor intensive</li>
    <li>Bad: is it right?</li>
    </ul>
</div>

<div class="slide">
    <h1>Second test: standalone</h1>
    <!--[[[cog
    include_file("porttest1.py")   # {{{
    ]]]-->
    <!--
    # porttest1.py
    from portfolio1 import Portfolio

    p = Portfolio()
    print "Empty portfolio cost: %s" % p.cost()
    p.buy("IBM", 100, 176.48)
    print "With 100 IBM @ 176.48: %s" % p.cost()
    p.buy("HPQ", 100, 36.15)
    print "With 100 HPQ @ 36.15: %s" % p.cost()
    -->
    <div class="code python"><div class="line"><span class="lineno">1</span> <span class="c">#&#xA0;porttest1.py</span>&nbsp;</div>
    <div class="line"><span class="lineno">2</span> <span class="kn">from</span>&#xA0;<span class="nn">portfolio1</span>&#xA0;<span class="kn">import</span>&#xA0;<span class="n">Portfolio</span>&nbsp;</div>
    <div class="line"><span class="lineno">3</span>&nbsp;</div>
    <div class="line"><span class="lineno">4</span> <span class="n">p</span>&#xA0;<span class="o">=</span>&#xA0;<span class="n">Portfolio</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="lineno">5</span> <span class="k">print</span>&#xA0;<span class="s">&quot;Empty&#xA0;portfolio&#xA0;cost:&#xA0;</span><span class="si">%s</span><span class="s">&quot;</span>&#xA0;<span class="o">%</span>&#xA0;<span class="n">p</span><span class="o">.</span><span class="n">cost</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="lineno">6</span> <span class="n">p</span><span class="o">.</span><span class="n">buy</span><span class="p">(</span><span class="s">&quot;IBM&quot;</span><span class="p">,</span>&#xA0;<span class="mi">100</span><span class="p">,</span>&#xA0;<span class="mf">176.48</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="lineno">7</span> <span class="k">print</span>&#xA0;<span class="s">&quot;With&#xA0;100&#xA0;IBM&#xA0;@&#xA0;176.48:&#xA0;</span><span class="si">%s</span><span class="s">&quot;</span>&#xA0;<span class="o">%</span>&#xA0;<span class="n">p</span><span class="o">.</span><span class="n">cost</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="lineno">8</span> <span class="n">p</span><span class="o">.</span><span class="n">buy</span><span class="p">(</span><span class="s">&quot;HPQ&quot;</span><span class="p">,</span>&#xA0;<span class="mi">100</span><span class="p">,</span>&#xA0;<span class="mf">36.15</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="lineno">9</span> <span class="k">print</span>&#xA0;<span class="s">&quot;With&#xA0;100&#xA0;HPQ&#xA0;@&#xA0;36.15:&#xA0;</span><span class="si">%s</span><span class="s">&quot;</span>&#xA0;<span class="o">%</span>&#xA0;<span class="n">p</span><span class="o">.</span><span class="n">cost</span><span class="p">()</span>&nbsp;</div>
    </div>
    <!--[[[end]]] }}}-->
    <!--[[[cog
    include_file("porttest1.out")   # {{{
    ]]]-->
    <!--
    $ python porttest1.py
    Empty portfolio cost: 0.0
    With 100 IBM @ 176.48: 17648.0
    With 100 HPQ @ 36.15: 21263.0
    -->
    <div class="code text"><div class="line"><span class="lineno">1</span> $&#xA0;python&#xA0;porttest1.py&nbsp;</div>
    <div class="line"><span class="lineno">2</span> Empty&#xA0;portfolio&#xA0;cost:&#xA0;0.0&nbsp;</div>
    <div class="line"><span class="lineno">3</span> With&#xA0;100&#xA0;IBM&#xA0;@&#xA0;176.48:&#xA0;17648.0&nbsp;</div>
    <div class="line"><span class="lineno">4</span> With&#xA0;100&#xA0;HPQ&#xA0;@&#xA0;36.15:&#xA0;21263.0&nbsp;</div>
    </div>
    <!--[[[end]]] }}}-->
    <ul>
        <li>Good: testing the code</li>
        <li>Better: repeatable</li>
        <li>Better: low effort</li>
        <li>Still bad: is it right?</li>
    </ul>
</div>

<div class="slide">
    <h1>Third test: expected results</h1>
    <!--[[[cog
    include_file("porttest2.py")   # {{{
    ]]]-->
    <!--
    # porttest2.py
    from portfolio1 import Portfolio

    p = Portfolio()
    print "Empty portfolio cost: %s, should be 0.0" % p.cost()
    p.buy("IBM", 100, 176.48)
    print "With 100 IBM @ 176.48: %s, should be 17648.0" % p.cost()
    p.buy("HPQ", 100, 36.15)
    print "With 100 HPQ @ 36.15: %s, should be 21263.0" % p.cost()
    -->
    <div class="code python"><div class="line"><span class="lineno">1</span> <span class="c">#&#xA0;porttest2.py</span>&nbsp;</div>
    <div class="line"><span class="lineno">2</span> <span class="kn">from</span>&#xA0;<span class="nn">portfolio1</span>&#xA0;<span class="kn">import</span>&#xA0;<span class="n">Portfolio</span>&nbsp;</div>
    <div class="line"><span class="lineno">3</span>&nbsp;</div>
    <div class="line"><span class="lineno">4</span> <span class="n">p</span>&#xA0;<span class="o">=</span>&#xA0;<span class="n">Portfolio</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="lineno">5</span> <span class="k">print</span>&#xA0;<span class="s">&quot;Empty&#xA0;portfolio&#xA0;cost:&#xA0;</span><span class="si">%s</span><span class="s">,&#xA0;should&#xA0;be&#xA0;0.0&quot;</span>&#xA0;<span class="o">%</span>&#xA0;<span class="n">p</span><span class="o">.</span><span class="n">cost</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="lineno">6</span> <span class="n">p</span><span class="o">.</span><span class="n">buy</span><span class="p">(</span><span class="s">&quot;IBM&quot;</span><span class="p">,</span>&#xA0;<span class="mi">100</span><span class="p">,</span>&#xA0;<span class="mf">176.48</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="lineno">7</span> <span class="k">print</span>&#xA0;<span class="s">&quot;With&#xA0;100&#xA0;IBM&#xA0;@&#xA0;176.48:&#xA0;</span><span class="si">%s</span><span class="s">,&#xA0;should&#xA0;be&#xA0;17648.0&quot;</span>&#xA0;<span class="o">%</span>&#xA0;<span class="n">p</span><span class="o">.</span><span class="n">cost</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="lineno">8</span> <span class="n">p</span><span class="o">.</span><span class="n">buy</span><span class="p">(</span><span class="s">&quot;HPQ&quot;</span><span class="p">,</span>&#xA0;<span class="mi">100</span><span class="p">,</span>&#xA0;<span class="mf">36.15</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="lineno">9</span> <span class="k">print</span>&#xA0;<span class="s">&quot;With&#xA0;100&#xA0;HPQ&#xA0;@&#xA0;36.15:&#xA0;</span><span class="si">%s</span><span class="s">,&#xA0;should&#xA0;be&#xA0;21263.0&quot;</span>&#xA0;<span class="o">%</span>&#xA0;<span class="n">p</span><span class="o">.</span><span class="n">cost</span><span class="p">()</span>&nbsp;</div>
    </div>
    <!--[[[end]]] }}} -->
    <!--[[[cog
    include_file("porttest2.out")   # {{{
    ]]]-->
    <!--
    $ python porttest2.py
    Empty portfolio cost: 0.0, should be 0.0
    With 100 IBM @ 176.48: 17648.0, should be 17648.0
    With 100 HPQ @ 36.15: 21263.0, should be 21263.0
    -->
    <div class="code text"><div class="line"><span class="lineno">1</span> $&#xA0;python&#xA0;porttest2.py&nbsp;</div>
    <div class="line"><span class="lineno">2</span> Empty&#xA0;portfolio&#xA0;cost:&#xA0;0.0,&#xA0;should&#xA0;be&#xA0;0.0&nbsp;</div>
    <div class="line"><span class="lineno">3</span> With&#xA0;100&#xA0;IBM&#xA0;@&#xA0;176.48:&#xA0;17648.0,&#xA0;should&#xA0;be&#xA0;17648.0&nbsp;</div>
    <div class="line"><span class="lineno">4</span> With&#xA0;100&#xA0;HPQ&#xA0;@&#xA0;36.15:&#xA0;21263.0,&#xA0;should&#xA0;be&#xA0;21263.0&nbsp;</div>
    </div>
        <!--[[[end]]] }}}-->
    <ul>
        <li>Good: testing the code repeatably with low effort</li>
        <li>Better: explicit expected results</li>
        <li>Bad: have to check the results yourself</li>
    </ul>
</div>

<div class="slide">
    <h1>Fourth test: check results automatically</h1>
    <!--[[[cog
    include_file("porttest3.py")   # {{{
    ]]]-->
    <!--
    # porttest3.py
    from portfolio1 import Portfolio

    p = Portfolio()
    print "Empty portfolio cost: %s, should be 0.0" % p.cost()
    assert p.cost() == 0.0
    p.buy("IBM", 100, 176.48)
    print "With 100 IBM @ 176.48: %s, should be 17648.0" % p.cost()
    assert p.cost() == 17648.0
    p.buy("HPQ", 100, 36.15)
    print "With 100 HPQ @ 36.15: %s, should be 21263.0" % p.cost()
    assert p.cost() == 21263.0
    -->
    <div class="code python"><div class="line"><span class="lineno"> 1</span> <span class="c">#&#xA0;porttest3.py</span>&nbsp;</div>
    <div class="line"><span class="lineno"> 2</span> <span class="kn">from</span>&#xA0;<span class="nn">portfolio1</span>&#xA0;<span class="kn">import</span>&#xA0;<span class="n">Portfolio</span>&nbsp;</div>
    <div class="line"><span class="lineno"> 3</span>&nbsp;</div>
    <div class="line"><span class="lineno"> 4</span> <span class="n">p</span>&#xA0;<span class="o">=</span>&#xA0;<span class="n">Portfolio</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="lineno"> 5</span> <span class="k">print</span>&#xA0;<span class="s">&quot;Empty&#xA0;portfolio&#xA0;cost:&#xA0;</span><span class="si">%s</span><span class="s">,&#xA0;should&#xA0;be&#xA0;0.0&quot;</span>&#xA0;<span class="o">%</span>&#xA0;<span class="n">p</span><span class="o">.</span><span class="n">cost</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="lineno"> 6</span> <span class="k">assert</span>&#xA0;<span class="n">p</span><span class="o">.</span><span class="n">cost</span><span class="p">()</span>&#xA0;<span class="o">==</span>&#xA0;<span class="mf">0.0</span>&nbsp;</div>
    <div class="line"><span class="lineno"> 7</span> <span class="n">p</span><span class="o">.</span><span class="n">buy</span><span class="p">(</span><span class="s">&quot;IBM&quot;</span><span class="p">,</span>&#xA0;<span class="mi">100</span><span class="p">,</span>&#xA0;<span class="mf">176.48</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="lineno"> 8</span> <span class="k">print</span>&#xA0;<span class="s">&quot;With&#xA0;100&#xA0;IBM&#xA0;@&#xA0;176.48:&#xA0;</span><span class="si">%s</span><span class="s">,&#xA0;should&#xA0;be&#xA0;17648.0&quot;</span>&#xA0;<span class="o">%</span>&#xA0;<span class="n">p</span><span class="o">.</span><span class="n">cost</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="lineno"> 9</span> <span class="k">assert</span>&#xA0;<span class="n">p</span><span class="o">.</span><span class="n">cost</span><span class="p">()</span>&#xA0;<span class="o">==</span>&#xA0;<span class="mf">17648.0</span>&nbsp;</div>
    <div class="line"><span class="lineno">10</span> <span class="n">p</span><span class="o">.</span><span class="n">buy</span><span class="p">(</span><span class="s">&quot;HPQ&quot;</span><span class="p">,</span>&#xA0;<span class="mi">100</span><span class="p">,</span>&#xA0;<span class="mf">36.15</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="lineno">11</span> <span class="k">print</span>&#xA0;<span class="s">&quot;With&#xA0;100&#xA0;HPQ&#xA0;@&#xA0;36.15:&#xA0;</span><span class="si">%s</span><span class="s">,&#xA0;should&#xA0;be&#xA0;21263.0&quot;</span>&#xA0;<span class="o">%</span>&#xA0;<span class="n">p</span><span class="o">.</span><span class="n">cost</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="lineno">12</span> <span class="k">assert</span>&#xA0;<span class="n">p</span><span class="o">.</span><span class="n">cost</span><span class="p">()</span>&#xA0;<span class="o">==</span>&#xA0;<span class="mf">21263.0</span>&nbsp;</div>
    </div>
    <!--[[[end]]] }}}-->
    <!--[[[cog
    include_file("porttest3.out")   # {{{
    ]]]-->
    <!--
    $ python porttest3.py
    Empty portfolio cost: 0.0, should be 0.0
    With 100 IBM @ 176.48: 17648.0, should be 17648.0
    With 100 HPQ @ 36.15: 21263.0, should be 21263.0
    -->
    <div class="code text"><div class="line"><span class="lineno">1</span> $&#xA0;python&#xA0;porttest3.py&nbsp;</div>
    <div class="line"><span class="lineno">2</span> Empty&#xA0;portfolio&#xA0;cost:&#xA0;0.0,&#xA0;should&#xA0;be&#xA0;0.0&nbsp;</div>
    <div class="line"><span class="lineno">3</span> With&#xA0;100&#xA0;IBM&#xA0;@&#xA0;176.48:&#xA0;17648.0,&#xA0;should&#xA0;be&#xA0;17648.0&nbsp;</div>
    <div class="line"><span class="lineno">4</span> With&#xA0;100&#xA0;HPQ&#xA0;@&#xA0;36.15:&#xA0;21263.0,&#xA0;should&#xA0;be&#xA0;21263.0&nbsp;</div>
    </div>
    <!--[[[end]]] }}}-->
    <ul>
        <li>Good: testing the code repeatably with low effort</li>
        <li>Good: explicit expected results</li>
        <li>Good: results checked automatically</li>
    </ul>
</div>

<div class="slide">
    <h1>Fourth test: what failure looks like</h1>
    <!--[[[cog
    include_file("porttest3_broken.out")   # {{{
    ]]]-->
    <!--
    $ python porttest3_broken.py
    Empty portfolio cost: 0.0, should be 0.0
    With 100 IBM @ 176.48: 17600.0, should be 17648.0
    Traceback (most recent call last):
      File "porttest3_broken.py", line 9, in <module>
        assert p.cost() == 17648.0
    AssertionError
    -->
    <div class="code text"><div class="line"><span class="lineno">1</span> $&#xA0;python&#xA0;porttest3_broken.py&nbsp;</div>
    <div class="line"><span class="lineno">2</span> Empty&#xA0;portfolio&#xA0;cost:&#xA0;0.0,&#xA0;should&#xA0;be&#xA0;0.0&nbsp;</div>
    <div class="line"><span class="lineno">3</span> With&#xA0;100&#xA0;IBM&#xA0;@&#xA0;176.48:&#xA0;17600.0,&#xA0;should&#xA0;be&#xA0;17648.0&nbsp;</div>
    <div class="line"><span class="lineno">4</span> Traceback&#xA0;(most&#xA0;recent&#xA0;call&#xA0;last):&nbsp;</div>
    <div class="line"><span class="lineno">5</span> &#xA0;&#xA0;File&#xA0;&quot;porttest3_broken.py&quot;,&#xA0;line&#xA0;9,&#xA0;in&#xA0;&lt;module&gt;&nbsp;</div>
    <div class="line"><span class="lineno">6</span> &#xA0;&#xA0;&#xA0;&#xA0;assert&#xA0;p.cost()&#xA0;==&#xA0;17648.0&nbsp;</div>
    <div class="line"><span class="lineno">7</span> AssertionError&nbsp;</div>
    </div>
    <!--[[[end]]] }}}-->
    <ul>
        <li>Good: testing the code repeatably with low effort</li>
        <li>Good: expected results checked automatically</li>
        <li>So-so: failure is visible, but output is cluttered with success</li>
        <li>Bad: failure prevents further tests</li>
    </ul>
</div>

<div class="slide">
    <h1>This is starting to get complicated!</h1>
    <ul>
        <li>Like any code, tests will grow</li>
        <li>A test is a real program</li>
        <li>Testing deserves real engineering</li>
        <li>Common issues can be handled in standard ways</li>
        <li>Unique issues can be handled in custom ways</li>
    </ul>
</div>

<!-- }}} -->

<!-- *** Using unittest {{{ -->
<div class="slide section" data-layout="clean">
    <h1>unittest</h1>
    <h2>Writing tests</h2>
</div>


<div class="slide">
    <h1>unittest</h1>
    <ul>
        <li>Part of the Python standard library</li>
        <li>Provides infrastructure for well-structured tests</li>
        <li>Provides a test runner</li>
        <li>Based on patterns used across many languages</li>
    </ul>
</div>

<div class="slide">
    <h1>Test classes</h1>
    <ul>
        <li>Tests are organized into classes</li>
        <li>Tests are methods starting with test_</li>
    </ul>
</div>

<div class="slide">
    <h1>A simple unit test</h1>
    <!--[[[cog
    include_file("test_port1.py")   # {{{
    ]]]-->
    <!--
    # test_port1.py

    import unittest
    from portfolio1 import Portfolio

    class PortfolioTest(unittest.TestCase):
        def test_ibm(self):
            p = Portfolio()
            p.buy("IBM", 100, 176.48)
            assert p.cost() == 17648.0

    if __name__ == '__main__':
        unittest.main()
    -->
    <div class="code python"><div class="line"><span class="lineno"> 1</span> <span class="c">#&#xA0;test_port1.py</span>&nbsp;</div>
    <div class="line"><span class="lineno"> 2</span>&nbsp;</div>
    <div class="line"><span class="lineno"> 3</span> <span class="kn">import</span>&#xA0;<span class="nn">unittest</span>&nbsp;</div>
    <div class="line"><span class="lineno"> 4</span> <span class="kn">from</span>&#xA0;<span class="nn">portfolio1</span>&#xA0;<span class="kn">import</span>&#xA0;<span class="n">Portfolio</span>&nbsp;</div>
    <div class="line"><span class="lineno"> 5</span>&nbsp;</div>
    <div class="line"><span class="lineno"> 6</span> <span class="k">class</span>&#xA0;<span class="nc">PortfolioTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>&nbsp;</div>
    <div class="line"><span class="lineno"> 7</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="k">def</span>&#xA0;<span class="nf">test_ibm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>&nbsp;</div>
    <div class="line"><span class="lineno"> 8</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">p</span>&#xA0;<span class="o">=</span>&#xA0;<span class="n">Portfolio</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="lineno"> 9</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">p</span><span class="o">.</span><span class="n">buy</span><span class="p">(</span><span class="s">&quot;IBM&quot;</span><span class="p">,</span>&#xA0;<span class="mi">100</span><span class="p">,</span>&#xA0;<span class="mf">176.48</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="lineno">10</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="k">assert</span>&#xA0;<span class="n">p</span><span class="o">.</span><span class="n">cost</span><span class="p">()</span>&#xA0;<span class="o">==</span>&#xA0;<span class="mf">17648.0</span>&nbsp;</div>
    <div class="line"><span class="lineno">11</span>&nbsp;</div>
    <div class="line"><span class="lineno">12</span> <span class="k">if</span>&#xA0;<span class="n">__name__</span>&#xA0;<span class="o">==</span>&#xA0;<span class="s">&#39;__main__&#39;</span><span class="p">:</span>&nbsp;</div>
    <div class="line"><span class="lineno">13</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>&nbsp;</div>
    </div>
    <!--[[[end]]] }}}-->
    <!--[[[cog
    include_file("test_port1.out")   # {{{
    ]]]-->
    <!--
    $ python test_port1.py
    .
    ––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––
    Ran 1 test in 0.000s

    OK
    -->
    <div class="code text"><div class="line"><span class="lineno">1</span> $&#xA0;python&#xA0;test_port1.py&nbsp;</div>
    <div class="line"><span class="lineno">2</span> .&nbsp;</div>
    <div class="line"><span class="lineno">3</span> ----------------------------------------------------------------------&nbsp;</div>
    <div class="line"><span class="lineno">4</span> Ran&#xA0;1&#xA0;test&#xA0;in&#xA0;0.000s&nbsp;</div>
    <div class="line"><span class="lineno">5</span>&nbsp;</div>
    <div class="line"><span class="lineno">6</span> OK&nbsp;</div>
    </div>
    <!--[[[end]]] }}}-->
</div>

<div class="slide">
    <h1>Under the covers</h1>
    <!--[[[cog
    include_code("""\
    # unittest runs the tests as if I had written:
    testcase = PortfolioTest()
    try:
        testcase.test_ibm()
    except:
        [record failure]
    else:
        [record success]
    """, lang="python")
    ]]]-->
    <div class="code python"><div class="line"><span class="c">#&#xA0;unittest&#xA0;runs&#xA0;the&#xA0;tests&#xA0;as&#xA0;if&#xA0;I&#xA0;had&#xA0;written:</span>&nbsp;</div>
    <div class="line"><span class="n">testcase</span>&#xA0;<span class="o">=</span>&#xA0;<span class="n">PortfolioTest</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="k">try</span><span class="p">:</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">testcase</span><span class="o">.</span><span class="n">test_ibm</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="k">except</span><span class="p">:</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="p">[</span><span class="n">record</span>&#xA0;<span class="n">failure</span><span class="p">]</span>&nbsp;</div>
    <div class="line"><span class="k">else</span><span class="p">:</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="p">[</span><span class="n">record</span>&#xA0;<span class="n">success</span><span class="p">]</span>&nbsp;</div>
    </div>
    <!--[[[end]]]-->
</div>

<div class="slide">
    <h1>Add more tests</h1>
    <!--[[[cog
    include_file("test_port2.py", start=6, end=20)   # {{{
    ]]]-->
    <!--
    class PortfolioTest(unittest.TestCase):
        def test_empty(self):
            p = Portfolio()
            assert p.cost() == 0.0

        def test_ibm(self):
            p = Portfolio()
            p.buy("IBM", 100, 176.48)
            assert p.cost() == 17648.0

        def test_ibm_hpq(self):
            p = Portfolio()
            p.buy("IBM", 100, 176.48)
            p.buy("HPQ", 100, 36.15)
            assert p.cost() == 21263.0
    -->
    <div class="code python"><div class="line"><span class="lineno"> 6</span> <span class="k">class</span>&#xA0;<span class="nc">PortfolioTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>&nbsp;</div>
    <div class="line"><span class="lineno"> 7</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="k">def</span>&#xA0;<span class="nf">test_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>&nbsp;</div>
    <div class="line"><span class="lineno"> 8</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">p</span>&#xA0;<span class="o">=</span>&#xA0;<span class="n">Portfolio</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="lineno"> 9</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="k">assert</span>&#xA0;<span class="n">p</span><span class="o">.</span><span class="n">cost</span><span class="p">()</span>&#xA0;<span class="o">==</span>&#xA0;<span class="mf">0.0</span>&nbsp;</div>
    <div class="line"><span class="lineno">10</span>&nbsp;</div>
    <div class="line"><span class="lineno">11</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="k">def</span>&#xA0;<span class="nf">test_ibm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>&nbsp;</div>
    <div class="line"><span class="lineno">12</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">p</span>&#xA0;<span class="o">=</span>&#xA0;<span class="n">Portfolio</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="lineno">13</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">p</span><span class="o">.</span><span class="n">buy</span><span class="p">(</span><span class="s">&quot;IBM&quot;</span><span class="p">,</span>&#xA0;<span class="mi">100</span><span class="p">,</span>&#xA0;<span class="mf">176.48</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="lineno">14</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="k">assert</span>&#xA0;<span class="n">p</span><span class="o">.</span><span class="n">cost</span><span class="p">()</span>&#xA0;<span class="o">==</span>&#xA0;<span class="mf">17648.0</span>&nbsp;</div>
    <div class="line"><span class="lineno">15</span>&nbsp;</div>
    <div class="line"><span class="lineno">16</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="k">def</span>&#xA0;<span class="nf">test_ibm_hpq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>&nbsp;</div>
    <div class="line"><span class="lineno">17</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">p</span>&#xA0;<span class="o">=</span>&#xA0;<span class="n">Portfolio</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="lineno">18</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">p</span><span class="o">.</span><span class="n">buy</span><span class="p">(</span><span class="s">&quot;IBM&quot;</span><span class="p">,</span>&#xA0;<span class="mi">100</span><span class="p">,</span>&#xA0;<span class="mf">176.48</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="lineno">19</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">p</span><span class="o">.</span><span class="n">buy</span><span class="p">(</span><span class="s">&quot;HPQ&quot;</span><span class="p">,</span>&#xA0;<span class="mi">100</span><span class="p">,</span>&#xA0;<span class="mf">36.15</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="lineno">20</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="k">assert</span>&#xA0;<span class="n">p</span><span class="o">.</span><span class="n">cost</span><span class="p">()</span>&#xA0;<span class="o">==</span>&#xA0;<span class="mf">21263.0</span>&nbsp;</div>
    </div>
    <!--[[[end]]] }}}-->
    <!--[[[cog
    include_file("test_port2.out")   # {{{
    ]]]-->
    <!--
    $ python test_port2.py
    ...
    ––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––
    Ran 3 tests in 0.000s

    OK
    -->
    <div class="code text"><div class="line"><span class="lineno">1</span> $&#xA0;python&#xA0;test_port2.py&nbsp;</div>
    <div class="line"><span class="lineno">2</span> ...&nbsp;</div>
    <div class="line"><span class="lineno">3</span> ----------------------------------------------------------------------&nbsp;</div>
    <div class="line"><span class="lineno">4</span> Ran&#xA0;3&#xA0;tests&#xA0;in&#xA0;0.000s&nbsp;</div>
    <div class="line"><span class="lineno">5</span>&nbsp;</div>
    <div class="line"><span class="lineno">6</span> OK&nbsp;</div>
    </div>
    <!--[[[end]]] }}}-->
    <ul>
        <li>A dot for every passed test</li>
    </ul>
</div>

<div class="slide">
    <h1>Under the covers</h1>
    <!--[[[cog
    include_code("""\
    # unittest runs the tests as if I had written:
    testcase = PortfolioTest()
    try:
        testcase.test_empty()
    except:
        [record failure]
    else:
        [record success]

    testcase = PortfolioTest()
    try:
        testcase.test_ibm()
    except:
        [record failure]
    else:
        [record success]
    
    testcase = PortfolioTest()
    try:
        testcase.test_ibm_hpq()
    except:
        [record failure]
    else:
        [record success]
    """, lang="python")
    ]]]-->
    <div class="code python"><div class="line"><span class="c">#&#xA0;unittest&#xA0;runs&#xA0;the&#xA0;tests&#xA0;as&#xA0;if&#xA0;I&#xA0;had&#xA0;written:</span>&nbsp;</div>
    <div class="line"><span class="n">testcase</span>&#xA0;<span class="o">=</span>&#xA0;<span class="n">PortfolioTest</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="k">try</span><span class="p">:</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">testcase</span><span class="o">.</span><span class="n">test_empty</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="k">except</span><span class="p">:</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="p">[</span><span class="n">record</span>&#xA0;<span class="n">failure</span><span class="p">]</span>&nbsp;</div>
    <div class="line"><span class="k">else</span><span class="p">:</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="p">[</span><span class="n">record</span>&#xA0;<span class="n">success</span><span class="p">]</span>&nbsp;</div>
    <div class="line">&nbsp;</div>
    <div class="line"><span class="n">testcase</span>&#xA0;<span class="o">=</span>&#xA0;<span class="n">PortfolioTest</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="k">try</span><span class="p">:</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">testcase</span><span class="o">.</span><span class="n">test_ibm</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="k">except</span><span class="p">:</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="p">[</span><span class="n">record</span>&#xA0;<span class="n">failure</span><span class="p">]</span>&nbsp;</div>
    <div class="line"><span class="k">else</span><span class="p">:</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="p">[</span><span class="n">record</span>&#xA0;<span class="n">success</span><span class="p">]</span>&nbsp;</div>
    <div class="line">&nbsp;</div>
    <div class="line"><span class="n">testcase</span>&#xA0;<span class="o">=</span>&#xA0;<span class="n">PortfolioTest</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="k">try</span><span class="p">:</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">testcase</span><span class="o">.</span><span class="n">test_ibm_hpq</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="k">except</span><span class="p">:</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="p">[</span><span class="n">record</span>&#xA0;<span class="n">failure</span><span class="p">]</span>&nbsp;</div>
    <div class="line"><span class="k">else</span><span class="p">:</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="p">[</span><span class="n">record</span>&#xA0;<span class="n">success</span><span class="p">]</span>&nbsp;</div>
    </div>
    <!--[[[end]]]-->
</div>

<div class="slide">
    <h1>Test isolation</h1>
    <ul>
        <li>Every test is run with a new test object</li>
        <li>Test isolation is very important</li>
        <li>Tests are focused on a small amount of code</li>
        <li>Tests can't affect each other</li>
        <li>Failure doesn't prevent further tests</li>
    </ul>
</div>

<div class="slide">
    <h1>What failure looks like</h1>
    <!--[[[cog
    include_file("test_port2_broken.out")   # {{{
    ]]]-->
    <!--
    $ python test_port2_broken.py
    .F.
    ======================================================================
    FAIL: test_ibm (__main__.PortfolioTest)
    ––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––
    Traceback (most recent call last):
      File "test_port2_broken.py", line 14, in test_ibm
        assert p.cost() == 17648.0
    AssertionError

    ––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––
    Ran 3 tests in 0.000s

    FAILED (failures=1)
    -->
    <div class="code text"><div class="line"><span class="lineno"> 1</span> $&#xA0;python&#xA0;test_port2_broken.py&nbsp;</div>
    <div class="line"><span class="lineno"> 2</span> .F.&nbsp;</div>
    <div class="line"><span class="lineno"> 3</span> ======================================================================&nbsp;</div>
    <div class="line"><span class="lineno"> 4</span> FAIL:&#xA0;test_ibm&#xA0;(__main__.PortfolioTest)&nbsp;</div>
    <div class="line"><span class="lineno"> 5</span> ----------------------------------------------------------------------&nbsp;</div>
    <div class="line"><span class="lineno"> 6</span> Traceback&#xA0;(most&#xA0;recent&#xA0;call&#xA0;last):&nbsp;</div>
    <div class="line"><span class="lineno"> 7</span> &#xA0;&#xA0;File&#xA0;&quot;test_port2_broken.py&quot;,&#xA0;line&#xA0;14,&#xA0;in&#xA0;test_ibm&nbsp;</div>
    <div class="line"><span class="lineno"> 8</span> &#xA0;&#xA0;&#xA0;&#xA0;assert&#xA0;p.cost()&#xA0;==&#xA0;17648.0&nbsp;</div>
    <div class="line"><span class="lineno"> 9</span> AssertionError&nbsp;</div>
    <div class="line"><span class="lineno">10</span>&nbsp;</div>
    <div class="line"><span class="lineno">11</span> ----------------------------------------------------------------------&nbsp;</div>
    <div class="line"><span class="lineno">12</span> Ran&#xA0;3&#xA0;tests&#xA0;in&#xA0;0.000s&nbsp;</div>
    <div class="line"><span class="lineno">13</span>&nbsp;</div>
    <div class="line"><span class="lineno">14</span> FAILED&#xA0;(failures=1)&nbsp;</div>
    </div>
    <!--[[[end]]] }}}-->
    <ul>
        <li>Better: the failed test didn't keep others from running</li>
        <li>Bad: what value was returned?</li>
    </ul>
</div>

<div class="slide">
    <h1>unittest assert helpers</h1>
    <ul>
        <li>Use self.assertEqual(x, y) instead of assert x == y</li>
        <li>You get nicer messages</li>
    </ul>
    <!--[[[cog
    include_file("test_port3.py", start=11, end=14, highlight=[14])   # {{{
    ]]]-->
    <!--
        def test_ibm(self):
            p = Portfolio()
            p.buy("IBM", 100, 176.48)
            self.assertEqual(p.cost(), 17648.0)
    -->
    <div class="code python"><div class="line"><span class="lineno">11</span> <span class="k">def</span>&#xA0;<span class="nf">test_ibm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>&nbsp;</div>
    <div class="line"><span class="lineno">12</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="n">p</span>&#xA0;<span class="o">=</span>&#xA0;<span class="n">Portfolio</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="lineno">13</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="n">p</span><span class="o">.</span><span class="n">buy</span><span class="p">(</span><span class="s">&quot;IBM&quot;</span><span class="p">,</span>&#xA0;<span class="mi">100</span><span class="p">,</span>&#xA0;<span class="mf">176.48</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="lineno">14</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">cost</span><span class="p">(),</span>&#xA0;<span class="mf">17648.0</span><span class="p">)</span>&nbsp;</div>
    </div>
    <!--[[[end]]] }}}-->
    <!--[[[cog
    include_file("test_port3_broken.out", highlight=[9])   # {{{
    ]]]-->
    <!--
    $ python test_port3_broken.py
    .F.
    ======================================================================
    FAIL: test_ibm (__main__.PortfolioTest)
    ––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––
    Traceback (most recent call last):
      File "test_port3_broken.py", line 14, in test_ibm
        self.assertEqual(p.cost(), 17648.0)
    AssertionError: 17600.0 != 17648.0

    ––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––
    Ran 3 tests in 0.000s

    FAILED (failures=1)
    -->
    <div class="code text"><div class="line"><span class="lineno"> 1</span> $&#xA0;python&#xA0;test_port3_broken.py&nbsp;</div>
    <div class="line"><span class="lineno"> 2</span> .F.&nbsp;</div>
    <div class="line"><span class="lineno"> 3</span> ======================================================================&nbsp;</div>
    <div class="line"><span class="lineno"> 4</span> FAIL:&#xA0;test_ibm&#xA0;(__main__.PortfolioTest)&nbsp;</div>
    <div class="line"><span class="lineno"> 5</span> ----------------------------------------------------------------------&nbsp;</div>
    <div class="line"><span class="lineno"> 6</span> Traceback&#xA0;(most&#xA0;recent&#xA0;call&#xA0;last):&nbsp;</div>
    <div class="line"><span class="lineno"> 7</span> &#xA0;&#xA0;File&#xA0;&quot;test_port3_broken.py&quot;,&#xA0;line&#xA0;14,&#xA0;in&#xA0;test_ibm&nbsp;</div>
    <div class="line"><span class="lineno"> 8</span> &#xA0;&#xA0;&#xA0;&#xA0;self.assertEqual(p.cost(),&#xA0;17648.0)&nbsp;</div>
    <div class="line"><span class="lineno"> 9</span> AssertionError:&#xA0;17600.0&#xA0;!=&#xA0;17648.0&nbsp;</div>
    <div class="line"><span class="lineno">10</span>&nbsp;</div>
    <div class="line"><span class="lineno">11</span> ----------------------------------------------------------------------&nbsp;</div>
    <div class="line"><span class="lineno">12</span> Ran&#xA0;3&#xA0;tests&#xA0;in&#xA0;0.000s&nbsp;</div>
    <div class="line"><span class="lineno">13</span>&nbsp;</div>
    <div class="line"><span class="lineno">14</span> FAILED&#xA0;(failures=1)&nbsp;</div>
    </div>
    <!--[[[end]]] }}}-->
</div>

<div class="slide">
    <h1>unittest assert helpers</h1>
    <ul>
        <li>There are lots of specialized assert methods</li>
    </ul>
    <!--[[[cog
    include_code("""\
    assertEqual(first, second)
    assertNotEqual(first, second)
    assertTrue(expr)
    assertFalse(expr)
    assertIn(first, second)
    assertNotIn(first, second)
    assertAlmostEqual(first, second)
    assertGreater(first, second)
    assertLess(first, second)
    assertRegexMatches(text, regexp)
    .. etc ..
    """, lang="python")
    ]]]-->
    <div class="code python"><div class="line"><span class="n">assertEqual</span><span class="p">(</span><span class="n">first</span><span class="p">,</span>&#xA0;<span class="n">second</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">first</span><span class="p">,</span>&#xA0;<span class="n">second</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="n">assertTrue</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="n">assertFalse</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="n">assertIn</span><span class="p">(</span><span class="n">first</span><span class="p">,</span>&#xA0;<span class="n">second</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="n">assertNotIn</span><span class="p">(</span><span class="n">first</span><span class="p">,</span>&#xA0;<span class="n">second</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">first</span><span class="p">,</span>&#xA0;<span class="n">second</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="n">assertGreater</span><span class="p">(</span><span class="n">first</span><span class="p">,</span>&#xA0;<span class="n">second</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="n">assertLess</span><span class="p">(</span><span class="n">first</span><span class="p">,</span>&#xA0;<span class="n">second</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="n">assertRegexMatches</span><span class="p">(</span><span class="n">text</span><span class="p">,</span>&#xA0;<span class="n">regexp</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="o">..</span>&#xA0;<span class="n">etc</span>&#xA0;<span class="o">..</span>&nbsp;</div>
    </div>
    <!--[[[end]]]-->
</div>

<div class="hidden_slide">
    <h1>Major enhancements in 2.7</h1>
    <ul>
        <li>unittest expanded significantly in 2.7 and 3.2</li>
        <li>Some of what I show here is only available then</li>
        <li>Test discovery</li>
        <li>More asserters</li>
    </ul>
</div>


<div class="slide">
    <h1>Three possible outcomes</h1>
    <ul>
        <li>Test raises an exception other than AssertionError</li>
        <li>Produces an E outcome</li>
    </ul>
    <!--[[[cog
    include_file("test_port3_broken2.out")   # {{{
    ]]]-->
    <!--
    $ python test_port3_broken2.py
    .E.
    ======================================================================
    ERROR: test_ibm (__main__.PortfolioTest)
    ––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––
    Traceback (most recent call last):
      File "test_port3_broken2.py", line 13, in test_ibm
        p.buyxxxxx("IBM", 100, 176.48)
    AttributeError: 'Portfolio' object has no attribute 'buyxxxxx'

    ––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––
    Ran 3 tests in 0.000s

    FAILED (errors=1)
    -->
    <div class="code text"><div class="line"><span class="lineno"> 1</span> $&#xA0;python&#xA0;test_port3_broken2.py&nbsp;</div>
    <div class="line"><span class="lineno"> 2</span> .E.&nbsp;</div>
    <div class="line"><span class="lineno"> 3</span> ======================================================================&nbsp;</div>
    <div class="line"><span class="lineno"> 4</span> ERROR:&#xA0;test_ibm&#xA0;(__main__.PortfolioTest)&nbsp;</div>
    <div class="line"><span class="lineno"> 5</span> ----------------------------------------------------------------------&nbsp;</div>
    <div class="line"><span class="lineno"> 6</span> Traceback&#xA0;(most&#xA0;recent&#xA0;call&#xA0;last):&nbsp;</div>
    <div class="line"><span class="lineno"> 7</span> &#xA0;&#xA0;File&#xA0;&quot;test_port3_broken2.py&quot;,&#xA0;line&#xA0;13,&#xA0;in&#xA0;test_ibm&nbsp;</div>
    <div class="line"><span class="lineno"> 8</span> &#xA0;&#xA0;&#xA0;&#xA0;p.buyxxxxx(&quot;IBM&quot;,&#xA0;100,&#xA0;176.48)&nbsp;</div>
    <div class="line"><span class="lineno"> 9</span> AttributeError:&#xA0;&#39;Portfolio&#39;&#xA0;object&#xA0;has&#xA0;no&#xA0;attribute&#xA0;&#39;buyxxxxx&#39;&nbsp;</div>
    <div class="line"><span class="lineno">10</span>&nbsp;</div>
    <div class="line"><span class="lineno">11</span> ----------------------------------------------------------------------&nbsp;</div>
    <div class="line"><span class="lineno">12</span> Ran&#xA0;3&#xA0;tests&#xA0;in&#xA0;0.000s&nbsp;</div>
    <div class="line"><span class="lineno">13</span>&nbsp;</div>
    <div class="line"><span class="lineno">14</span> FAILED&#xA0;(errors=1)&nbsp;</div>
    </div>
    <!--[[[end]]] }}}-->
</div>

<div class="slide">
    <h1>Under the covers</h1>
    <!--[[[cog
    include_code("""\
    testcase = PortfolioTest()
    try:
        testcase.test_method()
    except AssertionError:
        [record failure]
    except:
        [record error]
    else:
        [record success]
    """, lang="python")
    ]]]-->
    <div class="code python"><div class="line"><span class="n">testcase</span>&#xA0;<span class="o">=</span>&#xA0;<span class="n">PortfolioTest</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="k">try</span><span class="p">:</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">testcase</span><span class="o">.</span><span class="n">test_method</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="k">except</span>&#xA0;<span class="ne">AssertionError</span><span class="p">:</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="p">[</span><span class="n">record</span>&#xA0;<span class="n">failure</span><span class="p">]</span>&nbsp;</div>
    <div class="line"><span class="k">except</span><span class="p">:</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="p">[</span><span class="n">record</span>&#xA0;<span class="n">error</span><span class="p">]</span>&nbsp;</div>
    <div class="line"><span class="k">else</span><span class="p">:</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="p">[</span><span class="n">record</span>&#xA0;<span class="n">success</span><span class="p">]</span>&nbsp;</div>
    </div>
    <!--[[[end]]]-->
</div>

<div class="slide">
    <h1>Testing for failure</h1>
    <ul>
        <li>What if your code is supposed to raise an exception?</li>
    </ul>
    <!-- ** Interactive session {{{ -->
    <!--[[[cog
    prompt_session("""\
        from portfolio1 import Portfolio
        p = Portfolio()
        p.buy("IBM")
        """)
    ]]]-->
    <div class="code pycon"><div class="line"><span class="go">$&#xA0;python</span>&nbsp;</div>
    <div class="line"><span class="go">Python&#xA0;2.7.5&#xA0;(default,&#xA0;Aug&#xA0;&#xA0;5&#xA0;2013,&#xA0;19:47:08)&#xA0;</span>&nbsp;</div>
    <div class="line">&nbsp;</div>
    <div class="line"><span class="gp">&gt;&gt;&gt;&#xA0;</span><span class="kn">from</span>&#xA0;<span class="nn">portfolio1</span>&#xA0;<span class="kn">import</span>&#xA0;<span class="n">Portfolio</span>&nbsp;</div>
    <div class="line"><span class="gp">&gt;&gt;&gt;&#xA0;</span><span class="n">p</span>&#xA0;<span class="o">=</span>&#xA0;<span class="n">Portfolio</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="gp">&gt;&gt;&gt;&#xA0;</span><span class="n">p</span><span class="o">.</span><span class="n">buy</span><span class="p">(</span><span class="s">&quot;IBM&quot;</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="gt">Traceback&#xA0;(most&#xA0;recent&#xA0;call&#xA0;last):</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;File&#xA0;<span class="nb">&quot;&lt;console&gt;&quot;</span>,&#xA0;line&#xA0;<span class="m">1</span>,&#xA0;in&#xA0;<span class="n">&lt;module&gt;</span>&nbsp;</div>
    <div class="line"><span class="gr">TypeError</span>:&#xA0;<span class="n">buy()&#xA0;takes&#xA0;exactly&#xA0;4&#xA0;arguments&#xA0;(2&#xA0;given)</span>&nbsp;</div>
    </div>
    <!--[[[end]]] }}}-->
</div>

<div class="slide">
    <h1>Can't just call the function</h1>
    <!--[[[cog
    include_file("test_port4_broken.py", start=22, end=24)   # {{{
    ]]]-->
    <!--
        def test_bad_input(self):
            p = Portfolio()
            p.buy("IBM")
    -->
    <div class="code python"><div class="line"><span class="lineno">22</span> <span class="k">def</span>&#xA0;<span class="nf">test_bad_input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>&nbsp;</div>
    <div class="line"><span class="lineno">23</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="n">p</span>&#xA0;<span class="o">=</span>&#xA0;<span class="n">Portfolio</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="lineno">24</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="n">p</span><span class="o">.</span><span class="n">buy</span><span class="p">(</span><span class="s">&quot;IBM&quot;</span><span class="p">)</span>&nbsp;</div>
    </div>
    <!--[[[end]]] }}}-->
    <!--[[[cog
    include_file("test_port4_broken.out")   # {{{
    ]]]-->
    <!--
    $ python test_port4_broken.py
    E...
    ======================================================================
    ERROR: test_bad_input (__main__.PortfolioTest)
    ––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––
    Traceback (most recent call last):
      File "test_port4_broken.py", line 24, in test_bad_input
        p.buy("IBM")
    TypeError: buy() takes exactly 4 arguments (2 given)

    ––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––
    Ran 4 tests in 0.000s

    FAILED (errors=1)
    -->
    <div class="code text"><div class="line"><span class="lineno"> 1</span> $&#xA0;python&#xA0;test_port4_broken.py&nbsp;</div>
    <div class="line"><span class="lineno"> 2</span> E...&nbsp;</div>
    <div class="line"><span class="lineno"> 3</span> ======================================================================&nbsp;</div>
    <div class="line"><span class="lineno"> 4</span> ERROR:&#xA0;test_bad_input&#xA0;(__main__.PortfolioTest)&nbsp;</div>
    <div class="line"><span class="lineno"> 5</span> ----------------------------------------------------------------------&nbsp;</div>
    <div class="line"><span class="lineno"> 6</span> Traceback&#xA0;(most&#xA0;recent&#xA0;call&#xA0;last):&nbsp;</div>
    <div class="line"><span class="lineno"> 7</span> &#xA0;&#xA0;File&#xA0;&quot;test_port4_broken.py&quot;,&#xA0;line&#xA0;24,&#xA0;in&#xA0;test_bad_input&nbsp;</div>
    <div class="line"><span class="lineno"> 8</span> &#xA0;&#xA0;&#xA0;&#xA0;p.buy(&quot;IBM&quot;)&nbsp;</div>
    <div class="line"><span class="lineno"> 9</span> TypeError:&#xA0;buy()&#xA0;takes&#xA0;exactly&#xA0;4&#xA0;arguments&#xA0;(2&#xA0;given)&nbsp;</div>
    <div class="line"><span class="lineno">10</span>&nbsp;</div>
    <div class="line"><span class="lineno">11</span> ----------------------------------------------------------------------&nbsp;</div>
    <div class="line"><span class="lineno">12</span> Ran&#xA0;4&#xA0;tests&#xA0;in&#xA0;0.000s&nbsp;</div>
    <div class="line"><span class="lineno">13</span>&nbsp;</div>
    <div class="line"><span class="lineno">14</span> FAILED&#xA0;(errors=1)&nbsp;</div>
    </div>
    <!--[[[end]]] }}}-->
</div>

<div class="slide">
    <h1>assertRaises</h1>
    <ul>
        <li>assertRaises(exc, callable, arg1, arg2, ...)</li>
        <li>Have to provide callable and args separately</li>
    </ul>
    <!--[[[cog
    include_file("test_port4.py", start=22, end=24)   # {{{
    ]]]-->
    <!--
        def test_bad_input(self):
            p = Portfolio()
            self.assertRaises(TypeError, p.buy, "IBM")
    -->
    <div class="code python"><div class="line"><span class="lineno">22</span> <span class="k">def</span>&#xA0;<span class="nf">test_bad_input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>&nbsp;</div>
    <div class="line"><span class="lineno">23</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="n">p</span>&#xA0;<span class="o">=</span>&#xA0;<span class="n">Portfolio</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="lineno">24</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span>&#xA0;<span class="n">p</span><span class="o">.</span><span class="n">buy</span><span class="p">,</span>&#xA0;<span class="s">&quot;IBM&quot;</span><span class="p">)</span>&nbsp;</div>
    </div>
    <!--[[[end]]] }}}-->
    <!--[[[cog
    include_file("test_port4.out")   # {{{
    ]]]-->
    <!--
    $ python test_port4.py
    ....
    ––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––
    Ran 4 tests in 0.000s

    OK
    -->
    <div class="code text"><div class="line"><span class="lineno">1</span> $&#xA0;python&#xA0;test_port4.py&nbsp;</div>
    <div class="line"><span class="lineno">2</span> ....&nbsp;</div>
    <div class="line"><span class="lineno">3</span> ----------------------------------------------------------------------&nbsp;</div>
    <div class="line"><span class="lineno">4</span> Ran&#xA0;4&#xA0;tests&#xA0;in&#xA0;0.000s&nbsp;</div>
    <div class="line"><span class="lineno">5</span>&nbsp;</div>
    <div class="line"><span class="lineno">6</span> OK&nbsp;</div>
    </div>
    <!--[[[end]]] }}}-->
    <p>Nicer in 2.7:</p>
    <!--[[[cog
    include_code("""\
    def test_bad_input(self):
        p = Portfolio()
        with self.assertRaises(TypeError):
            p.buy("IBM")
    """, lang="python")
    ]]]-->
    <div class="code python"><div class="line"><span class="k">def</span>&#xA0;<span class="nf">test_bad_input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">p</span>&#xA0;<span class="o">=</span>&#xA0;<span class="n">Portfolio</span><span class="p">()</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="k">with</span>&#xA0;<span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">p</span><span class="o">.</span><span class="n">buy</span><span class="p">(</span><span class="s">&quot;IBM&quot;</span><span class="p">)</span>&nbsp;</div>
    </div>
    <!--[[[end]]]-->
</div>

<div class="slide">
    <h1>Add sell functionality</h1>
    <!--[[[cog
    include_file("portfolio2.py", start=21, end=30)   # {{{
    ]]]-->
    <!--
        def sell(self, name, shares):
            """Sell some number of shares of `name`."""
            for holding in self.stocks:
                if holding[0] == name:
                    if holding[1] < shares:
                        raise ValueError("Not enough shares")
                    holding[1] –= shares
                    break
            else:
                raise ValueError("You don't own that stock")
    -->
    <div class="code python"><div class="line"><span class="lineno">21</span> <span class="k">def</span>&#xA0;<span class="nf">sell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>&#xA0;<span class="n">name</span><span class="p">,</span>&#xA0;<span class="n">shares</span><span class="p">):</span>&nbsp;</div>
    <div class="line"><span class="lineno">22</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="sd">&quot;&quot;&quot;Sell&#xA0;some&#xA0;number&#xA0;of&#xA0;shares&#xA0;of&#xA0;`name`.&quot;&quot;&quot;</span>&nbsp;</div>
    <div class="line"><span class="lineno">23</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="k">for</span>&#xA0;<span class="n">holding</span>&#xA0;<span class="ow">in</span>&#xA0;<span class="bp">self</span><span class="o">.</span><span class="n">stocks</span><span class="p">:</span>&nbsp;</div>
    <div class="line"><span class="lineno">24</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="k">if</span>&#xA0;<span class="n">holding</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>&#xA0;<span class="o">==</span>&#xA0;<span class="n">name</span><span class="p">:</span>&nbsp;</div>
    <div class="line"><span class="lineno">25</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="k">if</span>&#xA0;<span class="n">holding</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>&#xA0;<span class="o">&lt;</span>&#xA0;<span class="n">shares</span><span class="p">:</span>&nbsp;</div>
    <div class="line"><span class="lineno">26</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="k">raise</span>&#xA0;<span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Not&#xA0;enough&#xA0;shares&quot;</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="lineno">27</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">holding</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>&#xA0;<span class="o">-=</span>&#xA0;<span class="n">shares</span>&nbsp;</div>
    <div class="line"><span class="lineno">28</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="k">break</span>&nbsp;</div>
    <div class="line"><span class="lineno">29</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="k">else</span><span class="p">:</span>&nbsp;</div>
    <div class="line"><span class="lineno">30</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="k">raise</span>&#xA0;<span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;You&#xA0;don&#39;t&#xA0;own&#xA0;that&#xA0;stock&quot;</span><span class="p">)</span>&nbsp;</div>
    </div>
    <!--[[[end]]] }}}-->
</div>

<div class="slide">
    <h1>Testing sell</h1>
    <!--[[[cog
    include_file("test_port5.py", start=26, end=49)   # {{{
    ]]]-->
    <!--
    class PortfolioSellTest(unittest.TestCase):
        def test_sell(self):
            p = Portfolio()
            p.buy("MSFT", 100, 27.0)
            p.buy("DELL", 100, 17.0)
            p.buy("ORCL", 100, 34.0)
            p.sell("MSFT", 50)
            self.assertEqual(p.cost(), 6450)

        def test_not_enough(self):
            p = Portfolio()
            p.buy("MSFT", 100, 27.0)
            p.buy("DELL", 100, 17.0)
            p.buy("ORCL", 100, 34.0)
            with self.assertRaises(ValueError):
                p.sell("MSFT", 200)

        def test_dont_own_it(self):
            p = Portfolio()
            p.buy("MSFT", 100, 27.0)
            p.buy("DELL", 100, 17.0)
            p.buy("ORCL", 100, 34.0)
            with self.assertRaises(ValueError):
                p.sell("IBM", 1)
    -->
    <div class="code python"><div class="line"><span class="lineno">26</span> <span class="k">class</span>&#xA0;<span class="nc">PortfolioSellTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>&nbsp;</div>
    <div class="line"><span class="lineno">27</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="k">def</span>&#xA0;<span class="nf">test_sell</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>&nbsp;</div>
    <div class="line"><span class="lineno">28</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">p</span>&#xA0;<span class="o">=</span>&#xA0;<span class="n">Portfolio</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="lineno">29</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">p</span><span class="o">.</span><span class="n">buy</span><span class="p">(</span><span class="s">&quot;MSFT&quot;</span><span class="p">,</span>&#xA0;<span class="mi">100</span><span class="p">,</span>&#xA0;<span class="mf">27.0</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="lineno">30</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">p</span><span class="o">.</span><span class="n">buy</span><span class="p">(</span><span class="s">&quot;DELL&quot;</span><span class="p">,</span>&#xA0;<span class="mi">100</span><span class="p">,</span>&#xA0;<span class="mf">17.0</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="lineno">31</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">p</span><span class="o">.</span><span class="n">buy</span><span class="p">(</span><span class="s">&quot;ORCL&quot;</span><span class="p">,</span>&#xA0;<span class="mi">100</span><span class="p">,</span>&#xA0;<span class="mf">34.0</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="lineno">32</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">p</span><span class="o">.</span><span class="n">sell</span><span class="p">(</span><span class="s">&quot;MSFT&quot;</span><span class="p">,</span>&#xA0;<span class="mi">50</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="lineno">33</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">cost</span><span class="p">(),</span>&#xA0;<span class="mi">6450</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="lineno">34</span>&nbsp;</div>
    <div class="line"><span class="lineno">35</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="k">def</span>&#xA0;<span class="nf">test_not_enough</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>&nbsp;</div>
    <div class="line"><span class="lineno">36</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">p</span>&#xA0;<span class="o">=</span>&#xA0;<span class="n">Portfolio</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="lineno">37</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">p</span><span class="o">.</span><span class="n">buy</span><span class="p">(</span><span class="s">&quot;MSFT&quot;</span><span class="p">,</span>&#xA0;<span class="mi">100</span><span class="p">,</span>&#xA0;<span class="mf">27.0</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="lineno">38</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">p</span><span class="o">.</span><span class="n">buy</span><span class="p">(</span><span class="s">&quot;DELL&quot;</span><span class="p">,</span>&#xA0;<span class="mi">100</span><span class="p">,</span>&#xA0;<span class="mf">17.0</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="lineno">39</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">p</span><span class="o">.</span><span class="n">buy</span><span class="p">(</span><span class="s">&quot;ORCL&quot;</span><span class="p">,</span>&#xA0;<span class="mi">100</span><span class="p">,</span>&#xA0;<span class="mf">34.0</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="lineno">40</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="k">with</span>&#xA0;<span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>&nbsp;</div>
    <div class="line"><span class="lineno">41</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">p</span><span class="o">.</span><span class="n">sell</span><span class="p">(</span><span class="s">&quot;MSFT&quot;</span><span class="p">,</span>&#xA0;<span class="mi">200</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="lineno">42</span>&nbsp;</div>
    <div class="line"><span class="lineno">43</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="k">def</span>&#xA0;<span class="nf">test_dont_own_it</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>&nbsp;</div>
    <div class="line"><span class="lineno">44</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">p</span>&#xA0;<span class="o">=</span>&#xA0;<span class="n">Portfolio</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="lineno">45</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">p</span><span class="o">.</span><span class="n">buy</span><span class="p">(</span><span class="s">&quot;MSFT&quot;</span><span class="p">,</span>&#xA0;<span class="mi">100</span><span class="p">,</span>&#xA0;<span class="mf">27.0</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="lineno">46</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">p</span><span class="o">.</span><span class="n">buy</span><span class="p">(</span><span class="s">&quot;DELL&quot;</span><span class="p">,</span>&#xA0;<span class="mi">100</span><span class="p">,</span>&#xA0;<span class="mf">17.0</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="lineno">47</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">p</span><span class="o">.</span><span class="n">buy</span><span class="p">(</span><span class="s">&quot;ORCL&quot;</span><span class="p">,</span>&#xA0;<span class="mi">100</span><span class="p">,</span>&#xA0;<span class="mf">34.0</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="lineno">48</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="k">with</span>&#xA0;<span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>&nbsp;</div>
    <div class="line"><span class="lineno">49</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">p</span><span class="o">.</span><span class="n">sell</span><span class="p">(</span><span class="s">&quot;IBM&quot;</span><span class="p">,</span>&#xA0;<span class="mi">1</span><span class="p">)</span>&nbsp;</div>
    </div>
    <!--[[[end]]] }}}-->
</div>

<div class="slide">
    <h1>Setting up a test</h1>
    <ul>
        <li>Tests can get repetitive</li>
        <li>Many tests may need similar setup</li>
        <li>A class can define setUp() to create initial state</li>
    </ul>
    <!--[[[cog
    include_file("test_port6.py", start=26, end=43)   # {{{
    ]]]-->
    <!--
    class PortfolioSellTest(unittest.TestCase):
        def setUp(self):
            self.p = Portfolio()
            self.p.buy("MSFT", 100, 27.0)
            self.p.buy("DELL", 100, 17.0)
            self.p.buy("ORCL", 100, 34.0)

        def test_sell(self):
            self.p.sell("MSFT", 50)
            self.assertEqual(self.p.cost(), 6450)

        def test_not_enough(self):
            with self.assertRaises(ValueError):
                self.p.sell("MSFT", 200)

        def test_dont_own_it(self):
            with self.assertRaises(ValueError):
                self.p.sell("IBM", 1)
    -->
    <div class="code python"><div class="line"><span class="lineno">26</span> <span class="k">class</span>&#xA0;<span class="nc">PortfolioSellTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>&nbsp;</div>
    <div class="line"><span class="lineno">27</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="k">def</span>&#xA0;<span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>&nbsp;</div>
    <div class="line"><span class="lineno">28</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="bp">self</span><span class="o">.</span><span class="n">p</span>&#xA0;<span class="o">=</span>&#xA0;<span class="n">Portfolio</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="lineno">29</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">buy</span><span class="p">(</span><span class="s">&quot;MSFT&quot;</span><span class="p">,</span>&#xA0;<span class="mi">100</span><span class="p">,</span>&#xA0;<span class="mf">27.0</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="lineno">30</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">buy</span><span class="p">(</span><span class="s">&quot;DELL&quot;</span><span class="p">,</span>&#xA0;<span class="mi">100</span><span class="p">,</span>&#xA0;<span class="mf">17.0</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="lineno">31</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">buy</span><span class="p">(</span><span class="s">&quot;ORCL&quot;</span><span class="p">,</span>&#xA0;<span class="mi">100</span><span class="p">,</span>&#xA0;<span class="mf">34.0</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="lineno">32</span>&nbsp;</div>
    <div class="line"><span class="lineno">33</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="k">def</span>&#xA0;<span class="nf">test_sell</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>&nbsp;</div>
    <div class="line"><span class="lineno">34</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sell</span><span class="p">(</span><span class="s">&quot;MSFT&quot;</span><span class="p">,</span>&#xA0;<span class="mi">50</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="lineno">35</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">cost</span><span class="p">(),</span>&#xA0;<span class="mi">6450</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="lineno">36</span>&nbsp;</div>
    <div class="line"><span class="lineno">37</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="k">def</span>&#xA0;<span class="nf">test_not_enough</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>&nbsp;</div>
    <div class="line"><span class="lineno">38</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="k">with</span>&#xA0;<span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>&nbsp;</div>
    <div class="line"><span class="lineno">39</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sell</span><span class="p">(</span><span class="s">&quot;MSFT&quot;</span><span class="p">,</span>&#xA0;<span class="mi">200</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="lineno">40</span>&nbsp;</div>
    <div class="line"><span class="lineno">41</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="k">def</span>&#xA0;<span class="nf">test_dont_own_it</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>&nbsp;</div>
    <div class="line"><span class="lineno">42</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="k">with</span>&#xA0;<span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>&nbsp;</div>
    <div class="line"><span class="lineno">43</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sell</span><span class="p">(</span><span class="s">&quot;IBM&quot;</span><span class="p">,</span>&#xA0;<span class="mi">1</span><span class="p">)</span>&nbsp;</div>
    </div>
    <!--[[[end]]] }}}-->
</div>

<div class="slide">
    <h1>Under the covers</h1>
    <!--[[[cog
    include_code("""\
        testcase = PortfolioTest()
        try:
            testcase.setUp()
        except:
            [record error]
        else:
            try:
                testcase.test_method()
            except AssertionError:
                [record failure]
            except:
                [record error]
            else:
                [record success]
            finally:
                try:
                    testcase.tearDown()
                except:
                    [record error]
    """, lang="python")
    ]]]-->
    <div class="code python"><div class="line"><span class="n">testcase</span>&#xA0;<span class="o">=</span>&#xA0;<span class="n">PortfolioTest</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="k">try</span><span class="p">:</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">testcase</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="k">except</span><span class="p">:</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="p">[</span><span class="n">record</span>&#xA0;<span class="n">error</span><span class="p">]</span>&nbsp;</div>
    <div class="line"><span class="k">else</span><span class="p">:</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="k">try</span><span class="p">:</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">testcase</span><span class="o">.</span><span class="n">test_method</span><span class="p">()</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="k">except</span>&#xA0;<span class="ne">AssertionError</span><span class="p">:</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="p">[</span><span class="n">record</span>&#xA0;<span class="n">failure</span><span class="p">]</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="k">except</span><span class="p">:</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="p">[</span><span class="n">record</span>&#xA0;<span class="n">error</span><span class="p">]</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="k">else</span><span class="p">:</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="p">[</span><span class="n">record</span>&#xA0;<span class="n">success</span><span class="p">]</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="k">finally</span><span class="p">:</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="k">try</span><span class="p">:</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">testcase</span><span class="o">.</span><span class="n">tearDown</span><span class="p">()</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="k">except</span><span class="p">:</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="p">[</span><span class="n">record</span>&#xA0;<span class="n">error</span><span class="p">]</span>&nbsp;</div>
    </div>
    <!--[[[end]]]-->
</div>

<div class="slide">
    <h1>setUp and tearDown: isolation!</h1>
    <ul>
        <li>Establish context for tests</li>
        <li>Use them for common pre-test or post-test work</li>
        <li>They ensure isolation, even in the face of failures</li>
    </ul>
</div>

<div class="slide">
    <h1>How NOT to do it</h1>
    <!--[[[cog
    include_code("""\
    class MyBadTestCase(unittest.TestCase):
        def test_a_thing(self):
            old_global = some_global_thing
            some_global_thing = new_test_value

            do_my_test_stuff()
            
            some_global_thing = old_global
    """, lang="python")
    ]]]-->
    <div class="code python"><div class="line"><span class="k">class</span>&#xA0;<span class="nc">MyBadTestCase</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="k">def</span>&#xA0;<span class="nf">test_a_thing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">old_global</span>&#xA0;<span class="o">=</span>&#xA0;<span class="n">some_global_thing</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">some_global_thing</span>&#xA0;<span class="o">=</span>&#xA0;<span class="n">new_test_value</span>&nbsp;</div>
    <div class="line">&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">do_my_test_stuff</span><span class="p">()</span>&nbsp;</div>
    <div class="line">&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">some_global_thing</span>&#xA0;<span class="o">=</span>&#xA0;<span class="n">old_global</span>&nbsp;</div>
    </div>
    <!--[[[end]]]-->
    <ul>
        <li>Common impulse</li>
        <li>But if test fails, globals aren't restored</li>
    </ul>
</div>

<div class="slide">
    <h1>The right way</h1>
    <!--[[[cog
    include_code("""\
    class MyGoodTestCase(unittest.TestCase):
        def setUp(self):
            self.old_global = some_global_thing
            some_global_thing = new_test_value

        def tearDown(self):
            some_global_thing = self.old_global

        def test_a_thing(self):
            do_my_test_stuff()
    """, lang="python")
    ]]]-->
    <div class="code python"><div class="line"><span class="k">class</span>&#xA0;<span class="nc">MyGoodTestCase</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="k">def</span>&#xA0;<span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="bp">self</span><span class="o">.</span><span class="n">old_global</span>&#xA0;<span class="o">=</span>&#xA0;<span class="n">some_global_thing</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">some_global_thing</span>&#xA0;<span class="o">=</span>&#xA0;<span class="n">new_test_value</span>&nbsp;</div>
    <div class="line">&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="k">def</span>&#xA0;<span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">some_global_thing</span>&#xA0;<span class="o">=</span>&#xA0;<span class="bp">self</span><span class="o">.</span><span class="n">old_global</span>&nbsp;</div>
    <div class="line">&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="k">def</span>&#xA0;<span class="nf">test_a_thing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">do_my_test_stuff</span><span class="p">()</span>&nbsp;</div>
    </div>
    <!--[[[end]]]-->
    <ul>
        <li>tearDown gets run no matter what *</li>
        <li>Reuse: same setUp and tearDown apply to all the test methods</li>
        <li>Test method is small and focused</li>
        <li>* unless setUp fails</li>
    </ul>
</div>

<div class="slide">
    <h1>A better way</h1>
    <!--[[[cog
    include_code("""\
    def test_with_special_settings(self):
        with patch_settings(SOMETHING='special', ANOTHER='weird'):
            do_my_test_stuff()
    """, lang="python")
    ]]]-->
    <div class="code python"><div class="line"><span class="k">def</span>&#xA0;<span class="nf">test_with_special_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="k">with</span>&#xA0;<span class="n">patch_settings</span><span class="p">(</span><span class="n">SOMETHING</span><span class="o">=</span><span class="s">&#39;special&#39;</span><span class="p">,</span>&#xA0;<span class="n">ANOTHER</span><span class="o">=</span><span class="s">&#39;weird&#39;</span><span class="p">):</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">do_my_test_stuff</span><span class="p">()</span>&nbsp;</div>
    </div>
    <!--[[[end]]]-->
    <!--[[[cog
    include_code("""\
    # From: http://stackoverflow.com/questions/913549
    from somewhere import MY_GLOBALS

    NO_SUCH_SETTING = object()

    @contextlib.contextmanager
    def patch_settings(**kwargs):
        old_settings = []
        for key, new_value in kwargs.items():
            old_value = getattr(MY_GLOBALS, key, NO_SUCH_SETTING)
            old_settings.append((key, old_value))
            setattr(MY_GLOBALS, key, new_value)

        yield

        for key, old_value in old_settings:
            if old_value is NO_SUCH_SETTING:
                delattr(MY_GLOBALS, key)
            else:
                setattr(MY_GLOBALS, key, old_value)
    """, lang="python")
    ]]]-->
    <div class="code python"><div class="line"><span class="c">#&#xA0;From:&#xA0;http://stackoverflow.com/questions/913549</span>&nbsp;</div>
    <div class="line"><span class="kn">from</span>&#xA0;<span class="nn">somewhere</span>&#xA0;<span class="kn">import</span>&#xA0;<span class="n">MY_GLOBALS</span>&nbsp;</div>
    <div class="line">&nbsp;</div>
    <div class="line"><span class="n">NO_SUCH_SETTING</span>&#xA0;<span class="o">=</span>&#xA0;<span class="nb">object</span><span class="p">()</span>&nbsp;</div>
    <div class="line">&nbsp;</div>
    <div class="line"><span class="nd">@contextlib.contextmanager</span>&nbsp;</div>
    <div class="line"><span class="k">def</span>&#xA0;<span class="nf">patch_settings</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">old_settings</span>&#xA0;<span class="o">=</span>&#xA0;<span class="p">[]</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="k">for</span>&#xA0;<span class="n">key</span><span class="p">,</span>&#xA0;<span class="n">new_value</span>&#xA0;<span class="ow">in</span>&#xA0;<span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">old_value</span>&#xA0;<span class="o">=</span>&#xA0;<span class="nb">getattr</span><span class="p">(</span><span class="n">MY_GLOBALS</span><span class="p">,</span>&#xA0;<span class="n">key</span><span class="p">,</span>&#xA0;<span class="n">NO_SUCH_SETTING</span><span class="p">)</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">old_settings</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">key</span><span class="p">,</span>&#xA0;<span class="n">old_value</span><span class="p">))</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="nb">setattr</span><span class="p">(</span><span class="n">MY_GLOBALS</span><span class="p">,</span>&#xA0;<span class="n">key</span><span class="p">,</span>&#xA0;<span class="n">new_value</span><span class="p">)</span>&nbsp;</div>
    <div class="line">&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="k">yield</span>&nbsp;</div>
    <div class="line">&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="k">for</span>&#xA0;<span class="n">key</span><span class="p">,</span>&#xA0;<span class="n">old_value</span>&#xA0;<span class="ow">in</span>&#xA0;<span class="n">old_settings</span><span class="p">:</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="k">if</span>&#xA0;<span class="n">old_value</span>&#xA0;<span class="ow">is</span>&#xA0;<span class="n">NO_SUCH_SETTING</span><span class="p">:</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="nb">delattr</span><span class="p">(</span><span class="n">MY_GLOBALS</span><span class="p">,</span>&#xA0;<span class="n">key</span><span class="p">)</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="k">else</span><span class="p">:</span>&nbsp;</div>
    <div class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="nb">setattr</span><span class="p">(</span><span class="n">MY_GLOBALS</span><span class="p">,</span>&#xA0;<span class="n">key</span><span class="p">,</span>&#xA0;<span class="n">old_value</span><span class="p">)</span>&nbsp;</div>
    </div>
    <!--[[[end]]]-->
</div>

<div class="slide">
    <h1>Tests are real code</h1>
    <ul>
        <li>Test helpers can become significant</li>
        <li>All the same techniques you use for product code, you can use for test code</li>
        <li>Helper functions, classes, etc.</li>
        <li>BTW: These helpers might need tests!</li>
    </ul>
</div>

<!-- }}} -->

<!-- *** Approaches {{{ -->
<div class="slide section todo" data-layout="clean">
    <h1>Approaches</h1>
    <h2>crafting tests</h2>
</div>

<div class="hidden_slide">
    <h1>What to test?</h1>
    <ul>
        <li>Any code that you want to work</li>
        <li>Start with what worries you</li>
        <li>Where are your bugs?</li>
    </ul>
</div>

<!--

- White box testing
- Black box testing
- Regression testing

- non-functional testing
    - performance
    - security
    - usability

-->

<div class="hidden_slide">
    <h1>How to start?</h1>
    <ul>
        <li>Pick a chunk of code</li>
        <li>What should it do?</li>
        <li>Test that</li>
        <li>What shouldn't it do?</li>
        <li>Test that</li>
    </ul>
</div>

<div class="hidden_slide">
    <h1>Test granularity</h1>
    <ul>
        <li>How big is the code chunk?</li>
        <li>Creates a hierarchy of tests:
            <ul>
                <li>Unit</li>
                <li>Functional</li>
                <li>Integration</li>
                <li>System</li>
            </ul></li>
        <li>Start small</li>
    </ul>
</div>


<div class="hidden_slide">
    <h1>What should the code do?</h1>
    <ul>
        <li>This can be difficult!</li>
        <li>Tests force you to decide</li>
        <li>Be as clear as you can</li>
        <li>(Document it in your docstrings)</li>
    </ul>
</div>

<div class="hidden_slide">
    <h1>Test what the code should do</h1>
    <ul>
        <li>Typical values</li>
        <li>Edge values</li>
        <li>Combinations of values</li>
    </ul>
</div>

<div class="hidden_slide">
    <h1>Test what the code shouldn't do</h1>
    <ul>
        <li>Error conditions</li>
        <li>Absurd values</li>
        <li>Common mistakes in usage</li>
        <li>Does it fail the way it should?</li>
    </ul>
</div>

<div class="hidden_slide">
    <h1>Where to put them?</h1>
    <ul>
        <li>Put tests in their own files</li>
        <li>Name them test_*.py</li>
        <li>Parallel to the code they're testing</li>
        <li>Pick your granularity</li>
    </ul>
</div>

<div class="hidden_slide">
    <h1>Good tests should be...</h1>
    <ul>
        <li>Automated</li>
        <li>Repeatable</li>
        <li>Convenient: fast</li>
        <li>Unambiguous</li>
    </ul>
</div>

<div class="hidden_slide">
    <h1>How much is enough?</h1>
    <ul>
        <li>Hard to know</li>
        <li>Depends on your needs</li>
        <li>Coverage measurement can help</li>
    </ul>
</div>

<div class="hidden_slide">
    <h1>Tests will fail</h1>
    <ul>
        <li>Could be the code is broken</li>
        <li>Could also be the tests are broken</li>
        <li>Tests have to be maintained</li>
        <li>Refactoring code might mean refactoring tests too</li>
    </ul>
</div>

<div class="hidden_slide">
    <h1>Test-Driven Development</h1>
    <ul>
        <li>Write tests before code!</li>
        <li>Ensures code is testable</li>
        <li>Produces better code</li>
    </ul>
</div>

<div class="hidden_slide">
    <h1>Testability</h1>
    <ul>
        <li>The quality of being testable</li>
        <li>Affects the design of your code</li>
        <li>Mostly: improved modularity</li>
        <li>See my PyCon 2010 talk: <a href='http://pycon.blip.tv/file/3261272'>Tests &amp; Testability</a></li>
    </ul>
</div>

<!-- }}} -->

<!-- *** nose {{{ -->
<div class="hidden_slide section" data-layout="clean">
    <h1>nose and py.test</h1>
    <h2>Running tests</h2>
</div>

<div class="hidden_slide">
    <h1>Test runners</h1>
    <ul>
        <li>Third-party test runners: nose, py.test, trial</li>
        <li>Know how to run your unittest tests</li>
        <li>Test discovery</li>
        <li>Run tests better</li>
        <li>Plugins provide lots of features</li>
    </ul>
</div>

<div class="hidden_slide">
    <h1>Test discovery</h1>
    <ul>
        <li>Running one file of tests is easy</li>
        <li>Pre-2.7 unittest: hard to run many test files</li>
        <li>New test runners provide test discovery</li>
        <li>They sniff out your tests wherever they are</li>
    </ul>
</div>

<!-- Unused slides {{{
<div class="hidden_slide">
    <h1>Running tests</h1>
    <ul>
        <li>Show test names as they run</li>
        <li>Capture stdout</li>
        <li>Stop on first failure</li>
        <li>These are also in 2.7 unittest</li>
    </ul>
</div>

<div class="hidden_slide">
    <h1>Plugins</h1>
    <ul>
        <li>LOTS of useful functions added by plugins</li>
        <li>parallel execution</li>
        <li>attribute-based test selection</li>
        <li>output formats: color, subunit, xml, etc</li>
        <li>extreme isolation</li>
        <li>django integration</li>
        <li>etc</li>
    </ul>
</div>

<div class="hidden_slide">
    <h1>Class-less tests</h1>
    <ul>
        <li>*Unit patterns are based on Smalltalk</li>
        <li>But Python can have code outside of classes</li>
        <li>So why do my tests have to be in classes?</li>
        <li>Test can be just functions</li>
        <li>And why can't my asserts be plain asserts?</li>
    </ul>
</div>

<div class="hidden_slide">
    <h1>Test generators</h1>
    <ul>
        <li>Tests can be created with a generator</li>
        <li>Generator yields callable + args</li>
        <li>Each yield is a separate test</li>
        <li>This produces four tests, two pass:</li>
    </ul>
    <pre class='brush: python'>
    def test_evens():
        for i in range(4):
            yield check_even, i

    def check_even(n):
        assert n % 2 == 0
    </pre>
    <pre class='brush: python'>
    def test_0():
        check_even(0)
    def test_1():
        check_even(1)
    def test_2():
        check_even(2)
    def test_3():
        check_even(3)
    </pre>
</div>

<div class="hidden_slide">
    <h1>nose and unittest together</h1>
    <ul>
        <li>nose extended unittest</li>
        <li>Then unittest grew in 2.7</li>
        <li>They don't always get along</li>
        <li>Be careful</li>
    </ul>
</div>

<div class="hidden_slide highlight_code_red">
    <h1>py.test</h1>
    <pre class='brush: plain, highlight: [17,18,19]'>
    $ py.test test_port2_broken.py
    =========================== test session starts ===========================
    platform win32 - - Python 2.7.2 - - pytest-2.1.0
    collected 3 items

    test_port2_broken.py .F.

    ================================ FAILURES =================================
    _________________________ PortfolioTest.test_ibm __________________________

    self = &lt;test_port2_broken.PortfolioTest testMethod=test_ibm>

        def test_ibm(self):
            p = Portfolio()
            p.buy("IBM", 100, 176)
    &gt;       assert p.cost() == 17648.0
    E       AssertionError: assert 17600.0 == 17648.0
    E        +  where 17600.0 = &lt;bound method Portfolio.cost of &lt;portfolio1.Por
    E        +    where &lt;bound method Portfolio.cost of &lt;portfolio1.Portfolio o

    test_port2_broken.py:14: AssertionError
    =================== 1 failed, 2 passed in 0.12 seconds ====================
    </pre>
</div>

<div class="hidden_slide">
    <h1>Twisted's trial</h1>
    <ul>
        <li>Many advanced options</li>
        <li>Some particular to Twisted</li>
        <li>Control GC between tests</li>
        <li>Check global state</li>
    </ul>
</div>

<div class="hidden_slide">
    <h1>IDEs</h1>
    <ul>
        <li>IDEs like Eclipse and Netbeans also have test runners</li>
        <li>Vim and Emacs too</li>
        <li>I know nothing about them</li>
        <li>They are probably awesome</li>
    </ul>
</div>

 }}} -->

<div class="hidden_slide">
    <h1>Test runners</h1>
    <ul>
        <li>unittest (2.7)</li>
        <li>nose, py.test, trial</li>
        <li>IDEs, Vim, Emacs</li>
    </ul>
</div>

<div class="hidden_slide">
    <h1>Lots of options</h1>
    <ul>
        <li>However you want to run your tests, you can</li>
        <li>Choose the runner that suits you</li>
        <li>Plugins allow further customization</li>
    </ul>
</div>

<!-- }}} -->

<!-- *** Coverage {{{ -->
<div class="hidden_slide section" data-layout="clean">
    <h1>Coverage</h1>
    <h2>Testing tests</h2>
</div>

<div class="hidden_slide">
    <h1>What code are you testing?</h1>
    <ul>
        <li>The goal: tests execute product code</li>
        <li>But do they really?</li>
        <li>How much of it?</li>
    </ul>
</div>

<div class="hidden_slide">
    <h1>Coverage measurement</h1>
    <ul>
        <li>Run your tests</li>
        <li>Track what parts of product code are executed</li>
        <li>Report on covered / not covered</li>
        <li>You find code not being tested</li>
        <li>Write more tests</li>
        <li>The world is better!</li>
    </ul>
</div>

<!--
<div class="hidden_slide">
    <h1>Running coverage.py</h1>
    <ul>
        <li>Install it from PyPI</li>
        <li><tt>coverage run my_prog.py arg ...</tt></li>
        <li><tt>coverage html</tt></li>
        <li>Or: &nbsp;<tt>nosetests - -with-cover ...</tt></li>
        <li>Or: &nbsp;<tt>py.test - -cov ...</tt></li>
    </ul>
</div>
-->

<div class="hidden_slide">
    <h1>HTML report</h1>
    <iframe src='test0_static/htmlcov/index.html' style='background:white;width:100%;height:85%;'></iframe>
</div>

<div class="hidden_slide">
    <h1>Coverage can only tell you a few things</h1>
    <ul>
        <li>What lines were executed</li>
        <li>What branches were taken</li>
        <li>100% coverage is difficult to reach</li>
        <li>100% coverage doesn't tell you everything</li>
    </ul>
</div>

<div class="hidden_slide">
    <h1>What coverage can't tell you</h1>
    <ul>
        <li>Are you exercising all your data?</li>
        <li>Are you exercising all your HTML templates?</li>
        <li>Are you checking results properly?</li>
        <li>Are you hitting all edge conditions?</li>
        <li>Are you testing the right things?</li>
        <li>Are you building the right product?  ;-)</li>
    </ul>
</div>


<!-- }}} -->

<!-- *** Mocking {{{ -->
<div class="slide section" data-layout="clean">
    <h1>Test Doubles</h1>
    <h2>Focusing tests</h2>
</div>

<div class="slide">
    <h1>Testing small amounts of code</h1>
    <ul>
        <li>Systems are built in layers</li>
        <li>Components depend on each other</li>
        <li>How to test just one component without its dependencies?</li>
    </ul>
</div>

<div class="slide">
    <h1>Dependencies are bad</h1>
    <ul>
        <li>More suspect code in each test</li>
        <li>Some components are slow</li>
        <li>Some components are unpredictable</li>
    </ul>
</div>

<div class="slide">
    <h1>Test Doubles</h1>
    <ul>
        <li>Replace a component's dependencies</li>
        <li>Focus on one component</li>
        <li>Different kinds: Mocks, stubs, fakes, etc</li>
    </ul>
    <img src='test0_static/mock.png'/>
</div>

<div class="slide">
    <h1>Real-time data!</h1>
    <ul>
        <li>Hit the web to get current stock prices</li>
    </ul>
    <!--[[[cog
    include_file("portfolio3.py", section="value")   # {{{
    ]]]-->
    <!--
        def current_prices(self):
            """Return a dict mapping names to current prices."""
            # http://download.finance.yahoo.com/d/quotes.csv?f=sl1&s=ibm,hpq
            # returns comma–separated values:
            #   "IBM",174.23
            #   "HPQ",35.13
            url = "http://download.finance.yahoo.com/d/quotes.csv?f=sl1&s="
            names = [name for name, shares, price in self.stocks]
            url += ",".join(sorted(names))
            data = urllib.urlopen(url)
            prices = dict((sym, float(last)) for sym, last in csv.reader(data))
            return prices

        def value(self):
            """Return the current value of the portfolio."""
            prices = self.current_prices()
            total = 0.0
            for name, shares, price in self.stocks:
                total += shares * prices[name]
            return total
    -->
    <div class="code python"><div class="line"><span class="lineno">51</span> <span class="k">def</span>&#xA0;<span class="nf">current_prices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>&nbsp;</div>
    <div class="line"><span class="lineno">52</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="sd">&quot;&quot;&quot;Return&#xA0;a&#xA0;dict&#xA0;mapping&#xA0;names&#xA0;to&#xA0;current&#xA0;prices.&quot;&quot;&quot;</span>&nbsp;</div>
    <div class="line"><span class="lineno">53</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="c">#&#xA0;http://download.finance.yahoo.com/d/quotes.csv?f=sl1&amp;s=ibm,hpq</span>&nbsp;</div>
    <div class="line"><span class="lineno">54</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="c">#&#xA0;returns&#xA0;comma-separated&#xA0;values:</span>&nbsp;</div>
    <div class="line"><span class="lineno">55</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="c">#&#xA0;&#xA0;&#xA0;&quot;IBM&quot;,174.23</span>&nbsp;</div>
    <div class="line"><span class="lineno">56</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="c">#&#xA0;&#xA0;&#xA0;&quot;HPQ&quot;,35.13</span>&nbsp;</div>
    <div class="line"><span class="lineno">57</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="n">url</span>&#xA0;<span class="o">=</span>&#xA0;<span class="s">&quot;http://download.finance.yahoo.com/d/quotes.csv?f=sl1&amp;s=&quot;</span>&nbsp;</div>
    <div class="line"><span class="lineno">58</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="n">names</span>&#xA0;<span class="o">=</span>&#xA0;<span class="p">[</span><span class="n">name</span>&#xA0;<span class="k">for</span>&#xA0;<span class="n">name</span><span class="p">,</span>&#xA0;<span class="n">shares</span><span class="p">,</span>&#xA0;<span class="n">price</span>&#xA0;<span class="ow">in</span>&#xA0;<span class="bp">self</span><span class="o">.</span><span class="n">stocks</span><span class="p">]</span>&nbsp;</div>
    <div class="line"><span class="lineno">59</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="n">url</span>&#xA0;<span class="o">+=</span>&#xA0;<span class="s">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">names</span><span class="p">))</span>&nbsp;</div>
    <div class="line"><span class="lineno">60</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="n">data</span>&#xA0;<span class="o">=</span>&#xA0;<span class="n">urllib</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="lineno">61</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="n">prices</span>&#xA0;<span class="o">=</span>&#xA0;<span class="nb">dict</span><span class="p">((</span><span class="n">sym</span><span class="p">,</span>&#xA0;<span class="nb">float</span><span class="p">(</span><span class="n">last</span><span class="p">))</span>&#xA0;<span class="k">for</span>&#xA0;<span class="n">sym</span><span class="p">,</span>&#xA0;<span class="n">last</span>&#xA0;<span class="ow">in</span>&#xA0;<span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>&nbsp;</div>
    <div class="line"><span class="lineno">62</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="k">return</span>&#xA0;<span class="n">prices</span>&nbsp;</div>
    <div class="line"><span class="lineno">63</span>&nbsp;</div>
    <div class="line"><span class="lineno">64</span> <span class="k">def</span>&#xA0;<span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>&nbsp;</div>
    <div class="line"><span class="lineno">65</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="sd">&quot;&quot;&quot;Return&#xA0;the&#xA0;current&#xA0;value&#xA0;of&#xA0;the&#xA0;portfolio.&quot;&quot;&quot;</span>&nbsp;</div>
    <div class="line"><span class="lineno">66</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="n">prices</span>&#xA0;<span class="o">=</span>&#xA0;<span class="bp">self</span><span class="o">.</span><span class="n">current_prices</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="lineno">67</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="n">total</span>&#xA0;<span class="o">=</span>&#xA0;<span class="mf">0.0</span>&nbsp;</div>
    <div class="line"><span class="lineno">68</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="k">for</span>&#xA0;<span class="n">name</span><span class="p">,</span>&#xA0;<span class="n">shares</span><span class="p">,</span>&#xA0;<span class="n">price</span>&#xA0;<span class="ow">in</span>&#xA0;<span class="bp">self</span><span class="o">.</span><span class="n">stocks</span><span class="p">:</span>&nbsp;</div>
    <div class="line"><span class="lineno">69</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">total</span>&#xA0;<span class="o">+=</span>&#xA0;<span class="n">shares</span>&#xA0;<span class="o">*</span>&#xA0;<span class="n">prices</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>&nbsp;</div>
    <div class="line"><span class="lineno">70</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="k">return</span>&#xA0;<span class="n">total</span>&nbsp;</div>
    </div>
    <!--[[[end]]] }}}-->
</div>

<div class="slide">
    <h1>It works great!</h1>
    <!-- ** Interactive session {{{ -->
    <!--[[[cog
    prompt_session("""\
        from portfolio3 import Portfolio
        p = Portfolio()
        p.buy("IBM", 100, 150.0)
        p.buy("HPQ", 100, 30.0)

        p.current_prices()
        
        p.value()
        """)
    ]]]-->
    <div class="code pycon"><div class="line"><span class="go">$&#xA0;python</span>&nbsp;</div>
    <div class="line"><span class="go">Python&#xA0;2.7.5&#xA0;(default,&#xA0;Aug&#xA0;&#xA0;5&#xA0;2013,&#xA0;19:47:08)&#xA0;</span>&nbsp;</div>
    <div class="line">&nbsp;</div>
    <div class="line"><span class="gp">&gt;&gt;&gt;&#xA0;</span><span class="kn">from</span>&#xA0;<span class="nn">portfolio3</span>&#xA0;<span class="kn">import</span>&#xA0;<span class="n">Portfolio</span>&nbsp;</div>
    <div class="line"><span class="gp">&gt;&gt;&gt;&#xA0;</span><span class="n">p</span>&#xA0;<span class="o">=</span>&#xA0;<span class="n">Portfolio</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="gp">&gt;&gt;&gt;&#xA0;</span><span class="n">p</span><span class="o">.</span><span class="n">buy</span><span class="p">(</span><span class="s">&quot;IBM&quot;</span><span class="p">,</span>&#xA0;<span class="mi">100</span><span class="p">,</span>&#xA0;<span class="mf">150.0</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="gp">&gt;&gt;&gt;&#xA0;</span><span class="n">p</span><span class="o">.</span><span class="n">buy</span><span class="p">(</span><span class="s">&quot;HPQ&quot;</span><span class="p">,</span>&#xA0;<span class="mi">100</span><span class="p">,</span>&#xA0;<span class="mf">30.0</span><span class="p">)</span>&nbsp;</div>
    <div class="line">&nbsp;</div>
    <div class="line"><span class="gp">&gt;&gt;&gt;&#xA0;</span><span class="n">p</span><span class="o">.</span><span class="n">current_prices</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="go">{&#39;HPQ&#39;:&#xA0;30.02,&#xA0;&#39;IBM&#39;:&#xA0;183.69}</span>&nbsp;</div>
    <div class="line">&nbsp;</div>
    <div class="line"><span class="gp">&gt;&gt;&gt;&#xA0;</span><span class="n">p</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="go">21371.0</span>&nbsp;</div>
    </div>
    <!--[[[end]]] }}}-->
</div>

<div class="slide">
    <h1>But how to test it?</h1>
    <ul>
        <li>Live data from the web is unpredictable</li>
        <li>Could be slowish</li>
        <li>Could be unavailable</li>
        <li>Question should be: 
            <ul>
                <li>"Assuming yahoo.com is working,</li>
                <li>does my code work?"</li>
            </ul></li>
    </ul>
</div>

<div class="slide">
    <h1>Fake implementation of current_prices</h1>
    <!--[[[cog
    include_file("test_port7.py", start=45, end=59)   # {{{
    ]]]-->
    <!--
    # Replace Portfolio.current_prices with a stub implementation.
    # This avoids the web, but also skips all our current_prices
    # code.
    class PortfolioValueTest(unittest.TestCase):
        def fake_current_prices(self):
            return {'IBM': 140.0, 'HPQ': 32.0}

        def setUp(self):
            self.p = Portfolio()
            self.p.buy("IBM", 100, 120.0)
            self.p.buy("HPQ", 100, 30.0)
            self.p.current_prices = self.fake_current_prices

        def test_value(self):
            self.assertEqual(self.p.value(), 17200)
    -->
    <div class="code python"><div class="line"><span class="lineno">45</span> <span class="c">#&#xA0;Replace&#xA0;Portfolio.current_prices&#xA0;with&#xA0;a&#xA0;stub&#xA0;implementation.</span>&nbsp;</div>
    <div class="line"><span class="lineno">46</span> <span class="c">#&#xA0;This&#xA0;avoids&#xA0;the&#xA0;web,&#xA0;but&#xA0;also&#xA0;skips&#xA0;all&#xA0;our&#xA0;current_prices</span>&nbsp;</div>
    <div class="line"><span class="lineno">47</span> <span class="c">#&#xA0;code.</span>&nbsp;</div>
    <div class="line"><span class="lineno">48</span> <span class="k">class</span>&#xA0;<span class="nc">PortfolioValueTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>&nbsp;</div>
    <div class="line"><span class="lineno">49</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="k">def</span>&#xA0;<span class="nf">fake_current_prices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>&nbsp;</div>
    <div class="line"><span class="lineno">50</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="k">return</span>&#xA0;<span class="p">{</span><span class="s">&#39;IBM&#39;</span><span class="p">:</span>&#xA0;<span class="mf">140.0</span><span class="p">,</span>&#xA0;<span class="s">&#39;HPQ&#39;</span><span class="p">:</span>&#xA0;<span class="mf">32.0</span><span class="p">}</span>&nbsp;</div>
    <div class="line"><span class="lineno">51</span>&nbsp;</div>
    <div class="line"><span class="lineno">52</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="k">def</span>&#xA0;<span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>&nbsp;</div>
    <div class="line"><span class="lineno">53</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="bp">self</span><span class="o">.</span><span class="n">p</span>&#xA0;<span class="o">=</span>&#xA0;<span class="n">Portfolio</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="lineno">54</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">buy</span><span class="p">(</span><span class="s">&quot;IBM&quot;</span><span class="p">,</span>&#xA0;<span class="mi">100</span><span class="p">,</span>&#xA0;<span class="mf">120.0</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="lineno">55</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">buy</span><span class="p">(</span><span class="s">&quot;HPQ&quot;</span><span class="p">,</span>&#xA0;<span class="mi">100</span><span class="p">,</span>&#xA0;<span class="mf">30.0</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="lineno">56</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">current_prices</span>&#xA0;<span class="o">=</span>&#xA0;<span class="bp">self</span><span class="o">.</span><span class="n">fake_current_prices</span>&nbsp;</div>
    <div class="line"><span class="lineno">57</span>&nbsp;</div>
    <div class="line"><span class="lineno">58</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="k">def</span>&#xA0;<span class="nf">test_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>&nbsp;</div>
    <div class="line"><span class="lineno">59</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">value</span><span class="p">(),</span>&#xA0;<span class="mi">17200</span><span class="p">)</span>&nbsp;</div>
    </div>
    <!--[[[end]]] }}}-->
    <ul>
        <li>Good: test results are predictable</li>
    </ul>
</div>

<div class="slide">
    <h1>But some code isn't tested!</h1>
    <!--[[[cog
    include_file("test_port7.out", highlight=[10])   # {{{
    ]]]-->
    <!--
    $ coverage run test_port7.py
    ........
    ––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––
    Ran 8 tests in 0.001s

    OK
    $ coverage report –m
    Name         Stmts   Miss  Cover   Missing
    ––––––––––––––––––––––––––––––––––––––––––
    portfolio3      33      6    82%   57–62
    test_port7      45      0   100%   
    ––––––––––––––––––––––––––––––––––––––––––
    TOTAL           78      6    92%   
    -->
    <div class="code text"><div class="line"><span class="lineno"> 1</span> $&#xA0;coverage&#xA0;run&#xA0;test_port7.py&nbsp;</div>
    <div class="line"><span class="lineno"> 2</span> ........&nbsp;</div>
    <div class="line"><span class="lineno"> 3</span> ----------------------------------------------------------------------&nbsp;</div>
    <div class="line"><span class="lineno"> 4</span> Ran&#xA0;8&#xA0;tests&#xA0;in&#xA0;0.001s&nbsp;</div>
    <div class="line"><span class="lineno"> 5</span>&nbsp;</div>
    <div class="line"><span class="lineno"> 6</span> OK&nbsp;</div>
    <div class="line"><span class="lineno"> 7</span> $&#xA0;coverage&#xA0;report&#xA0;-m&nbsp;</div>
    <div class="line"><span class="lineno"> 8</span> Name&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;Stmts&#xA0;&#xA0;&#xA0;Miss&#xA0;&#xA0;Cover&#xA0;&#xA0;&#xA0;Missing&nbsp;</div>
    <div class="line"><span class="lineno"> 9</span> ------------------------------------------&nbsp;</div>
    <div class="line"><span class="lineno">10</span> portfolio3&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;33&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;6&#xA0;&#xA0;&#xA0;&#xA0;82%&#xA0;&#xA0;&#xA0;57-62&nbsp;</div>
    <div class="line"><span class="lineno">11</span> test_port7&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;45&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;0&#xA0;&#xA0;&#xA0;100%&#xA0;&#xA0;&#xA0;&nbsp;</div>
    <div class="line"><span class="lineno">12</span> ------------------------------------------&nbsp;</div>
    <div class="line"><span class="lineno">13</span> TOTAL&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;78&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;6&#xA0;&#xA0;&#xA0;&#xA0;92%&nbsp;</div>
    </div>
    <!--[[[end]]] }}}-->
    <!--[[[cog
    include_file("portfolio3.py", start=51, end=62)   # {{{
    ]]]-->
    <!--
        def current_prices(self):
            """Return a dict mapping names to current prices."""
            # http://download.finance.yahoo.com/d/quotes.csv?f=sl1&s=ibm,hpq
            # returns comma–separated values:
            #   "IBM",174.23
            #   "HPQ",35.13
            url = "http://download.finance.yahoo.com/d/quotes.csv?f=sl1&s="
            names = [name for name, shares, price in self.stocks]
            url += ",".join(sorted(names))
            data = urllib.urlopen(url)
            prices = dict((sym, float(last)) for sym, last in csv.reader(data))
            return prices
    -->
    <div class="code python"><div class="line"><span class="lineno">51</span> <span class="k">def</span>&#xA0;<span class="nf">current_prices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>&nbsp;</div>
    <div class="line"><span class="lineno">52</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="sd">&quot;&quot;&quot;Return&#xA0;a&#xA0;dict&#xA0;mapping&#xA0;names&#xA0;to&#xA0;current&#xA0;prices.&quot;&quot;&quot;</span>&nbsp;</div>
    <div class="line"><span class="lineno">53</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="c">#&#xA0;http://download.finance.yahoo.com/d/quotes.csv?f=sl1&amp;s=ibm,hpq</span>&nbsp;</div>
    <div class="line"><span class="lineno">54</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="c">#&#xA0;returns&#xA0;comma-separated&#xA0;values:</span>&nbsp;</div>
    <div class="line"><span class="lineno">55</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="c">#&#xA0;&#xA0;&#xA0;&quot;IBM&quot;,174.23</span>&nbsp;</div>
    <div class="line"><span class="lineno">56</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="c">#&#xA0;&#xA0;&#xA0;&quot;HPQ&quot;,35.13</span>&nbsp;</div>
    <div class="line"><span class="lineno">57</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="n">url</span>&#xA0;<span class="o">=</span>&#xA0;<span class="s">&quot;http://download.finance.yahoo.com/d/quotes.csv?f=sl1&amp;s=&quot;</span>&nbsp;</div>
    <div class="line"><span class="lineno">58</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="n">names</span>&#xA0;<span class="o">=</span>&#xA0;<span class="p">[</span><span class="n">name</span>&#xA0;<span class="k">for</span>&#xA0;<span class="n">name</span><span class="p">,</span>&#xA0;<span class="n">shares</span><span class="p">,</span>&#xA0;<span class="n">price</span>&#xA0;<span class="ow">in</span>&#xA0;<span class="bp">self</span><span class="o">.</span><span class="n">stocks</span><span class="p">]</span>&nbsp;</div>
    <div class="line"><span class="lineno">59</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="n">url</span>&#xA0;<span class="o">+=</span>&#xA0;<span class="s">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">names</span><span class="p">))</span>&nbsp;</div>
    <div class="line"><span class="lineno">60</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="n">data</span>&#xA0;<span class="o">=</span>&#xA0;<span class="n">urllib</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="lineno">61</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="n">prices</span>&#xA0;<span class="o">=</span>&#xA0;<span class="nb">dict</span><span class="p">((</span><span class="n">sym</span><span class="p">,</span>&#xA0;<span class="nb">float</span><span class="p">(</span><span class="n">last</span><span class="p">))</span>&#xA0;<span class="k">for</span>&#xA0;<span class="n">sym</span><span class="p">,</span>&#xA0;<span class="n">last</span>&#xA0;<span class="ow">in</span>&#xA0;<span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>&nbsp;</div>
    <div class="line"><span class="lineno">62</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="k">return</span>&#xA0;<span class="n">prices</span>&nbsp;</div>
    </div>
    <!--[[[end]]] }}}-->
</div>

<div class="slide">
    <h1>Fake urllib.urlopen instead</h1>
    <!--[[[cog
    include_file("test_port8.py", section="fake")   # {{{
    ]]]-->
    <!--
    # A simple fake for urllib that implements only one method,
    # and is only good for one request.  You can make this much
    # more complex for your own needs.
    class FakeUrllib(object):
        """An object that can stand in for the urllib module."""

        def urlopen(self, url):
            """A stub urllib.urlopen() implementation."""
            return StringIO('"IBM",140\n"HPQ",32\n')


    class PortfolioValueTest(unittest.TestCase):
        def setUp(self):
            self.old_urllib = portfolio3.urllib
            portfolio3.urllib = FakeUrllib()

            self.p = Portfolio()
            self.p.buy("IBM", 100, 120.0)
            self.p.buy("HPQ", 100, 30.0)

        def tearDown(self):
            portfolio3.urllib = self.old_urllib

        def test_value(self):
            self.assertEqual(self.p.value(), 17200)
    -->
    <div class="code python"><div class="line"><span class="lineno">48</span> <span class="c">#&#xA0;A&#xA0;simple&#xA0;fake&#xA0;for&#xA0;urllib&#xA0;that&#xA0;implements&#xA0;only&#xA0;one&#xA0;method,</span>&nbsp;</div>
    <div class="line"><span class="lineno">49</span> <span class="c">#&#xA0;and&#xA0;is&#xA0;only&#xA0;good&#xA0;for&#xA0;one&#xA0;request.&#xA0;&#xA0;You&#xA0;can&#xA0;make&#xA0;this&#xA0;much</span>&nbsp;</div>
    <div class="line"><span class="lineno">50</span> <span class="c">#&#xA0;more&#xA0;complex&#xA0;for&#xA0;your&#xA0;own&#xA0;needs.</span>&nbsp;</div>
    <div class="line"><span class="lineno">51</span> <span class="k">class</span>&#xA0;<span class="nc">FakeUrllib</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>&nbsp;</div>
    <div class="line"><span class="lineno">52</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="sd">&quot;&quot;&quot;An&#xA0;object&#xA0;that&#xA0;can&#xA0;stand&#xA0;in&#xA0;for&#xA0;the&#xA0;urllib&#xA0;module.&quot;&quot;&quot;</span>&nbsp;</div>
    <div class="line"><span class="lineno">53</span>&nbsp;</div>
    <div class="line"><span class="lineno">54</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="k">def</span>&#xA0;<span class="nf">urlopen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>&#xA0;<span class="n">url</span><span class="p">):</span>&nbsp;</div>
    <div class="line"><span class="lineno">55</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="sd">&quot;&quot;&quot;A&#xA0;stub&#xA0;urllib.urlopen()&#xA0;implementation.&quot;&quot;&quot;</span>&nbsp;</div>
    <div class="line"><span class="lineno">56</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="k">return</span>&#xA0;<span class="n">StringIO</span><span class="p">(</span><span class="s">&#39;&quot;IBM&quot;,140</span><span class="se">\n</span><span class="s">&quot;HPQ&quot;,32</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="lineno">57</span>&nbsp;</div>
    <div class="line"><span class="lineno">58</span>&nbsp;</div>
    <div class="line"><span class="lineno">59</span> <span class="k">class</span>&#xA0;<span class="nc">PortfolioValueTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>&nbsp;</div>
    <div class="line"><span class="lineno">60</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="k">def</span>&#xA0;<span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>&nbsp;</div>
    <div class="line"><span class="lineno">61</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="bp">self</span><span class="o">.</span><span class="n">old_urllib</span>&#xA0;<span class="o">=</span>&#xA0;<span class="n">portfolio3</span><span class="o">.</span><span class="n">urllib</span>&nbsp;</div>
    <div class="line"><span class="lineno">62</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">portfolio3</span><span class="o">.</span><span class="n">urllib</span>&#xA0;<span class="o">=</span>&#xA0;<span class="n">FakeUrllib</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="lineno">63</span>&nbsp;</div>
    <div class="line"><span class="lineno">64</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="bp">self</span><span class="o">.</span><span class="n">p</span>&#xA0;<span class="o">=</span>&#xA0;<span class="n">Portfolio</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="lineno">65</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">buy</span><span class="p">(</span><span class="s">&quot;IBM&quot;</span><span class="p">,</span>&#xA0;<span class="mi">100</span><span class="p">,</span>&#xA0;<span class="mf">120.0</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="lineno">66</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">buy</span><span class="p">(</span><span class="s">&quot;HPQ&quot;</span><span class="p">,</span>&#xA0;<span class="mi">100</span><span class="p">,</span>&#xA0;<span class="mf">30.0</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="lineno">67</span>&nbsp;</div>
    <div class="line"><span class="lineno">68</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="k">def</span>&#xA0;<span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>&nbsp;</div>
    <div class="line"><span class="lineno">69</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">portfolio3</span><span class="o">.</span><span class="n">urllib</span>&#xA0;<span class="o">=</span>&#xA0;<span class="bp">self</span><span class="o">.</span><span class="n">old_urllib</span>&nbsp;</div>
    <div class="line"><span class="lineno">70</span>&nbsp;</div>
    <div class="line"><span class="lineno">71</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="k">def</span>&#xA0;<span class="nf">test_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>&nbsp;</div>
    <div class="line"><span class="lineno">72</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">value</span><span class="p">(),</span>&#xA0;<span class="mi">17200</span><span class="p">)</span>&nbsp;</div>
    </div>
    <!--[[[end]]] }}}-->
</div>

<div class="slide">
    <h1>All of our code is executed</h1>
    <!--[[[cog
    include_file("test_port8.out")   # {{{
    ]]]-->
    <!--
    $ coverage run test_port8.py
    ........
    ––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––
    Ran 8 tests in 0.001s

    OK
    $ coverage report –m
    Name         Stmts   Miss  Cover   Missing
    ––––––––––––––––––––––––––––––––––––––––––
    portfolio3      33      0   100%   
    test_port8      51      0   100%   
    ––––––––––––––––––––––––––––––––––––––––––
    TOTAL           84      0   100%   
    -->
    <div class="code text"><div class="line"><span class="lineno"> 1</span> $&#xA0;coverage&#xA0;run&#xA0;test_port8.py&nbsp;</div>
    <div class="line"><span class="lineno"> 2</span> ........&nbsp;</div>
    <div class="line"><span class="lineno"> 3</span> ----------------------------------------------------------------------&nbsp;</div>
    <div class="line"><span class="lineno"> 4</span> Ran&#xA0;8&#xA0;tests&#xA0;in&#xA0;0.001s&nbsp;</div>
    <div class="line"><span class="lineno"> 5</span>&nbsp;</div>
    <div class="line"><span class="lineno"> 6</span> OK&nbsp;</div>
    <div class="line"><span class="lineno"> 7</span> $&#xA0;coverage&#xA0;report&#xA0;-m&nbsp;</div>
    <div class="line"><span class="lineno"> 8</span> Name&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;Stmts&#xA0;&#xA0;&#xA0;Miss&#xA0;&#xA0;Cover&#xA0;&#xA0;&#xA0;Missing&nbsp;</div>
    <div class="line"><span class="lineno"> 9</span> ------------------------------------------&nbsp;</div>
    <div class="line"><span class="lineno">10</span> portfolio3&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;33&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;0&#xA0;&#xA0;&#xA0;100%&#xA0;&#xA0;&#xA0;&nbsp;</div>
    <div class="line"><span class="lineno">11</span> test_port8&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;51&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;0&#xA0;&#xA0;&#xA0;100%&#xA0;&#xA0;&#xA0;&nbsp;</div>
    <div class="line"><span class="lineno">12</span> ------------------------------------------&nbsp;</div>
    <div class="line"><span class="lineno">13</span> TOTAL&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;84&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;0&#xA0;&#xA0;&#xA0;100%&nbsp;</div>
    </div>
    <!--[[[end]]] }}}-->
    <ul>
        <li>Stdlib is stubbed</li>
        <li>All our code is run</li>
        <li>No web access during tests</li>
    </ul>
</div>

<div class="slide">
    <h1>Even better: mock objects</h1>
    <ul>
        <li>Mock objects are automatic chameleons</li>
        <li>Can act like any object</li>
        <li>Also record what happened to them</li>
        <li>You can make assertions after the fact</li>
    </ul>
</div>

<div class="slide">
    <h1>Automatic chameleons</h1>
    <!-- ** Interactive session {{{ -->
    <!--[[[cog
    prompt_session("""\
        import mock, StringIO

        # Make a mock object, call it, ask what was called.
        m = mock.Mock()
        m.foo(3, "hello")
        m.bar(17).baz("ned").quux(47)
        m.method_calls

        # Make a real object, give it a mock function
        s = StringIO.StringIO()
        s.fake_function = mock.Mock()
        s.fake_function.return_value = "Success!"
        s.fake_function(42)
        s.fake_function.call_args

        # The real methods still work
        s.write("hello")
        s.getvalue()
        """, command=False)
    ]]]-->
    <div class="code pycon"><div class="line"><span class="gp">&gt;&gt;&gt;&#xA0;</span><span class="kn">import</span>&#xA0;<span class="nn">mock</span><span class="o">,</span>&#xA0;<span class="nn">StringIO</span>&nbsp;</div>
    <div class="line">&nbsp;</div>
    <div class="line"><span class="gp">&gt;&gt;&gt;&#xA0;</span><span class="c">#&#xA0;Make&#xA0;a&#xA0;mock&#xA0;object,&#xA0;call&#xA0;it,&#xA0;ask&#xA0;what&#xA0;was&#xA0;called.</span>&nbsp;</div>
    <div class="line"><span class="gp">&gt;&gt;&gt;&#xA0;</span><span class="n">m</span>&#xA0;<span class="o">=</span>&#xA0;<span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="gp">&gt;&gt;&gt;&#xA0;</span><span class="n">m</span><span class="o">.</span><span class="n">foo</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span>&#xA0;<span class="s">&quot;hello&quot;</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="go">&lt;Mock&#xA0;name=&#39;mock.foo()&#39;&#xA0;id=&#39;4383194320&#39;&gt;</span>&nbsp;</div>
    <div class="line"><span class="gp">&gt;&gt;&gt;&#xA0;</span><span class="n">m</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span><span class="o">.</span><span class="n">baz</span><span class="p">(</span><span class="s">&quot;ned&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">quux</span><span class="p">(</span><span class="mi">47</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="go">&lt;Mock&#xA0;name=&#39;mock.bar().baz().quux()&#39;&#xA0;id=&#39;4384249104&#39;&gt;</span>&nbsp;</div>
    <div class="line"><span class="gp">&gt;&gt;&gt;&#xA0;</span><span class="n">m</span><span class="o">.</span><span class="n">method_calls</span>&nbsp;</div>
    <div class="line"><span class="go">[call.foo(3,&#xA0;&#39;hello&#39;),&#xA0;call.bar(17)]</span>&nbsp;</div>
    <div class="line">&nbsp;</div>
    <div class="line"><span class="gp">&gt;&gt;&gt;&#xA0;</span><span class="c">#&#xA0;Make&#xA0;a&#xA0;real&#xA0;object,&#xA0;give&#xA0;it&#xA0;a&#xA0;mock&#xA0;function</span>&nbsp;</div>
    <div class="line"><span class="gp">&gt;&gt;&gt;&#xA0;</span><span class="n">s</span>&#xA0;<span class="o">=</span>&#xA0;<span class="n">StringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="gp">&gt;&gt;&gt;&#xA0;</span><span class="n">s</span><span class="o">.</span><span class="n">fake_function</span>&#xA0;<span class="o">=</span>&#xA0;<span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="gp">&gt;&gt;&gt;&#xA0;</span><span class="n">s</span><span class="o">.</span><span class="n">fake_function</span><span class="o">.</span><span class="n">return_value</span>&#xA0;<span class="o">=</span>&#xA0;<span class="s">&quot;Success!&quot;</span>&nbsp;</div>
    <div class="line"><span class="gp">&gt;&gt;&gt;&#xA0;</span><span class="n">s</span><span class="o">.</span><span class="n">fake_function</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="go">&#39;Success!&#39;</span>&nbsp;</div>
    <div class="line"><span class="gp">&gt;&gt;&gt;&#xA0;</span><span class="n">s</span><span class="o">.</span><span class="n">fake_function</span><span class="o">.</span><span class="n">call_args</span>&nbsp;</div>
    <div class="line"><span class="go">call(42)</span>&nbsp;</div>
    <div class="line">&nbsp;</div>
    <div class="line"><span class="gp">&gt;&gt;&gt;&#xA0;</span><span class="c">#&#xA0;The&#xA0;real&#xA0;methods&#xA0;still&#xA0;work</span>&nbsp;</div>
    <div class="line"><span class="gp">&gt;&gt;&gt;&#xA0;</span><span class="n">s</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="gp">&gt;&gt;&gt;&#xA0;</span><span class="n">s</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="go">&#39;hello&#39;</span>&nbsp;</div>
    </div>
    <!--[[[end]]] }}}-->
</div>

<div class="slide">
    <h1>Mocking with no set up</h1>
    <!--[[[cog
    include_file("test_port9.py", section="mock")   # {{{
    ]]]-->
    <!--
    class PortfolioValueTest(unittest.TestCase):
        def setUp(self):
            self.p = Portfolio()
            self.p.buy("IBM", 100, 120.0)
            self.p.buy("HPQ", 100, 30.0)

        def test_value(self):
            # Create a mock urllib.urlopen
            with mock.patch('urllib.urlopen') as urlopen:

                # When called, it will return this value
                urlopen.return_value = StringIO('"IBM",140\n"HPQ",32\n')

                # Run the test!
                self.assertEqual(self.p.value(), 17200)

                # We can ask the mock what its arguments were
                urlopen.assert_called_with(
                    "http://download.finance.yahoo.com/d/quotes.csv"
                    "?f=sl1&s=HPQ,IBM"
                    )
    -->
    <div class="code python"><div class="line"><span class="lineno">49</span> <span class="k">class</span>&#xA0;<span class="nc">PortfolioValueTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>&nbsp;</div>
    <div class="line"><span class="lineno">50</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="k">def</span>&#xA0;<span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>&nbsp;</div>
    <div class="line"><span class="lineno">51</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="bp">self</span><span class="o">.</span><span class="n">p</span>&#xA0;<span class="o">=</span>&#xA0;<span class="n">Portfolio</span><span class="p">()</span>&nbsp;</div>
    <div class="line"><span class="lineno">52</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">buy</span><span class="p">(</span><span class="s">&quot;IBM&quot;</span><span class="p">,</span>&#xA0;<span class="mi">100</span><span class="p">,</span>&#xA0;<span class="mf">120.0</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="lineno">53</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">buy</span><span class="p">(</span><span class="s">&quot;HPQ&quot;</span><span class="p">,</span>&#xA0;<span class="mi">100</span><span class="p">,</span>&#xA0;<span class="mf">30.0</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="lineno">54</span>&nbsp;</div>
    <div class="line"><span class="lineno">55</span> &#xA0;&#xA0;&#xA0;&#xA0;<span class="k">def</span>&#xA0;<span class="nf">test_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>&nbsp;</div>
    <div class="line"><span class="lineno">56</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="c">#&#xA0;Create&#xA0;a&#xA0;mock&#xA0;urllib.urlopen</span>&nbsp;</div>
    <div class="line"><span class="lineno">57</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="k">with</span>&#xA0;<span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s">&#39;urllib.urlopen&#39;</span><span class="p">)</span>&#xA0;<span class="k">as</span>&#xA0;<span class="n">urlopen</span><span class="p">:</span>&nbsp;</div>
    <div class="line"><span class="lineno">58</span>&nbsp;</div>
    <div class="line"><span class="lineno">59</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="c">#&#xA0;When&#xA0;called,&#xA0;it&#xA0;will&#xA0;return&#xA0;this&#xA0;value</span>&nbsp;</div>
    <div class="line"><span class="lineno">60</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">urlopen</span><span class="o">.</span><span class="n">return_value</span>&#xA0;<span class="o">=</span>&#xA0;<span class="n">StringIO</span><span class="p">(</span><span class="s">&#39;&quot;IBM&quot;,140</span><span class="se">\n</span><span class="s">&quot;HPQ&quot;,32</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="lineno">61</span>&nbsp;</div>
    <div class="line"><span class="lineno">62</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="c">#&#xA0;Run&#xA0;the&#xA0;test!</span>&nbsp;</div>
    <div class="line"><span class="lineno">63</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">value</span><span class="p">(),</span>&#xA0;<span class="mi">17200</span><span class="p">)</span>&nbsp;</div>
    <div class="line"><span class="lineno">64</span>&nbsp;</div>
    <div class="line"><span class="lineno">65</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="c">#&#xA0;We&#xA0;can&#xA0;ask&#xA0;the&#xA0;mock&#xA0;what&#xA0;its&#xA0;arguments&#xA0;were</span>&nbsp;</div>
    <div class="line"><span class="lineno">66</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="n">urlopen</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span>&nbsp;</div>
    <div class="line"><span class="lineno">67</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="s">&quot;http://download.finance.yahoo.com/d/quotes.csv&quot;</span>&nbsp;</div>
    <div class="line"><span class="lineno">68</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="s">&quot;?f=sl1&amp;s=HPQ,IBM&quot;</span>&nbsp;</div>
    <div class="line"><span class="lineno">69</span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="p">)</span>&nbsp;</div>
    </div>
    <!--[[[end]]] }}}-->
    <ul>
        <li>Using Foord's Mock: <a href='http://www.voidspace.org.uk/python/mock/'>http://www.voidspace.org.uk/python/mock</a></li>
    </ul>
</div>

<div class="slide">
    <h1>Test doubles</h1>
    <ul>
        <li>A powerful way to isolate your code</li>
        <li>Focuses tests on one thing at a time</li>
        <li>Removes speed bumps and randomness</li>
        <li>Lots of libraries to make it easier</li>
        <li>Also called Dependency Injection</li>
    </ul>
</div>

<!-- }}} -->

<!-- *** Other topics {{{ -->
<!--
<div class="slide section" data-layout="clean">
    <h1>Other topics</h1>
    <h2>You should at least know what these are</h2>
</div>

<div class="slide">
    <h1>Doctest</h1>
    <ul>
        <li>Run code snippets in docstrings</li>
        <li>Parses console sessions to find tests and results.</li>
        <li>Good for testing code in docs</li>
        <li>Don't use it for testing product code</li>
    </ul>
</div>

-->

<!-- }}} -->


<div class="slide section" data-layout="clean">
    <h1>Summing up</h1>
</div>

<div class="slide">
    <h1>Testing is...</h1>
    <ul>
        <li>Complicated</li>
        <li>Important</li>
        <li>Worthy</li>
        <li>Rewarding</li>
    </ul>
</div>

<div class="slide">
    <h1>Resources</h1>
    <ul>
        <li>Testing In Python mailing list</li>
        <li>Python meetup! Project Night 8/11</li>
        <li>#bostonpython and #python on freenode</li>
    </ul>
</div>

<!--
    Things to add:

    - Start writing tests for bugs you find.
    - Changing mindsets is hard.
        - How do you get people on board?
-->

<div class="slide thankyou" data-layout="clean">
    <h1 style='margin-top:1em'>Thank You</h1>
    <h1 style='margin:1em; font-size:140%'>http://nedbatchelder.com/text/starttest.html</h1>
    <h1 style='margin:1em; font-size:140%'>@nedbat</h1>
    
    <!--
    <p style='text-align:center; margin-top:7em;'>PS: I'm available for freelance work :)</p>
    -->
    <p style='text-align:center; font-size:85%; margin-top:9em;'>
    <i>Made with Cog, Slippy, and Fontin.</i>
    </p>
</div>

</body>
</html>
<!-- vim: set foldmethod=marker: -->
